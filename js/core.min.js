var T=window.BDW_T,CFG=window.BDW_CFG,_units="metric";function setUnits(e){_units=e;var t=document.getElementById("btn-metric"),n=document.getElementById("btn-us");t&&t.classList.toggle("active","metric"===e),n&&n.classList.toggle("active","us"===e),window._lastRows&&window._lastSc&&(computeAndRenderScore(window._lastSc,window._lastRows),updateHero(window._lastSc,window._lastRows))}function fmtTemp(e){return null==e?"‚Äì":"us"===_units?Math.round(9*e/5+32)+"¬∞F":Math.round(e)+"¬∞C"}function fmtTempRaw(e){return null==e?null:"us"===_units?Math.round(9*e/5+32):Math.round(e)}function fmtTempUnit(){return"us"===_units?"¬∞F":"¬∞C"}function fmtWind(e){return null==e?"‚Äì":"us"===_units?Math.round(.621371*e)+" mph":Math.round(e)+" km/h"}function fmtPrecip(e){if(null==e)return"‚Äì";if("us"===_units){var t=.0393701*e;return(t<.1?t.toFixed(2):t.toFixed(1))+" in"}return e+" mm"}var IC={sun:'<svg viewBox="0 0 40 40" fill="none"><circle cx="20" cy="20" r="8" fill="#f59e0b"/><g stroke="#f59e0b" stroke-width="2.2" stroke-linecap="round"><line x1="20" y1="4" x2="20" y2="9"/><line x1="20" y1="31" x2="20" y2="36"/><line x1="4" y1="20" x2="9" y2="20"/><line x1="31" y1="20" x2="36" y2="20"/><line x1="8.7" y1="8.7" x2="12.2" y2="12.2"/><line x1="27.8" y1="27.8" x2="31.3" y2="31.3"/><line x1="31.3" y1="8.7" x2="27.8" y2="12.2"/><line x1="12.2" y1="27.8" x2="8.7" y2="31.3"/></g></svg>',partcloud:'<svg viewBox="0 0 40 40" fill="none"><circle cx="15" cy="15" r="6" fill="#f59e0b" opacity=".9"/><g stroke="#f59e0b" stroke-width="1.8" stroke-linecap="round"><line x1="15" y1="5" x2="15" y2="8"/><line x1="5" y1="15" x2="8" y2="15"/><line x1="8.8" y1="8.8" x2="11" y2="11"/><line x1="21.2" y1="8.8" x2="19" y2="11"/></g><rect x="9" y="22" width="22" height="11" rx="5.5" fill="#93c5e8"/><ellipse cx="17" cy="22" rx="6" ry="5.5" fill="#a8d4f0"/><ellipse cx="23" cy="23" rx="5" ry="4.5" fill="#bde0f8"/></svg>',cloud:'<svg viewBox="0 0 40 40" fill="none"><rect x="7" y="20" width="26" height="13" rx="6.5" fill="#93a8c0"/><ellipse cx="17" cy="20" rx="8" ry="7" fill="#a8bccc"/><ellipse cx="25" cy="21" rx="7" ry="6" fill="#bcd0e0"/></svg>',lightrain:'<svg viewBox="0 0 40 40" fill="none"><rect x="6" y="11" width="28" height="11" rx="5.5" fill="#6a92b0"/><ellipse cx="16" cy="11" rx="8" ry="6.5" fill="#7aa2c0"/><ellipse cx="25" cy="12" rx="7" ry="5.5" fill="#8ab4d0"/><g stroke="#3b82f6" stroke-width="2.2" stroke-linecap="round"><line x1="18" y1="25" x2="16" y2="33"/></g></svg>',rain:'<svg viewBox="0 0 40 40" fill="none"><rect x="6" y="11" width="28" height="11" rx="5.5" fill="#6a92b0"/><ellipse cx="16" cy="11" rx="8" ry="6.5" fill="#7aa2c0"/><ellipse cx="25" cy="12" rx="7" ry="5.5" fill="#8ab4d0"/><g stroke="#3b82f6" stroke-width="2.2" stroke-linecap="round"><line x1="13" y1="25" x2="11" y2="33"/><line x1="20" y1="25" x2="18" y2="33"/><line x1="27" y1="25" x2="25" y2="33"/></g></svg>',heavyrain:'<svg viewBox="0 0 40 40" fill="none"><rect x="4" y="9" width="32" height="11" rx="5.5" fill="#5a7a98"/><ellipse cx="14" cy="9" rx="9" ry="7" fill="#6a8aa8"/><ellipse cx="27" cy="10" rx="9" ry="6.5" fill="#7a9ab8"/><g stroke="#2563eb" stroke-width="2.2" stroke-linecap="round"><line x1="10" y1="23" x2="8" y2="32"/><line x1="16" y1="23" x2="14" y2="32"/><line x1="22" y1="23" x2="20" y2="32"/><line x1="28" y1="23" x2="26" y2="32"/></g></svg>',storm:'<svg viewBox="0 0 40 40" fill="none"><rect x="3" y="7" width="34" height="12" rx="6" fill="#4a6070"/><ellipse cx="13" cy="7" rx="9" ry="7" fill="#5a7080"/><ellipse cx="28" cy="8" rx="9" ry="6.5" fill="#6a8090"/><polyline points="23,19 18,28 22,28 16,38" stroke="#f59e0b" stroke-width="2.8" stroke-linecap="round" stroke-linejoin="round" fill="none"/></svg>',snow:'<svg viewBox="0 0 40 40" fill="none"><rect x="6" y="11" width="28" height="11" rx="5.5" fill="#a0c4e0"/><ellipse cx="16" cy="11" rx="8" ry="6.5" fill="#b0d4f0"/><ellipse cx="25" cy="12" rx="7" ry="5.5" fill="#c0e0f8"/><g stroke="#60a0d0" stroke-width="2" stroke-linecap="round"><line x1="12" y1="26" x2="12" y2="35"/><line x1="8.5" y1="28" x2="15.5" y2="33"/><line x1="8.5" y1="33" x2="15.5" y2="28"/><line x1="20" y1="26" x2="20" y2="35"/><line x1="16.5" y1="28" x2="23.5" y2="33"/><line x1="16.5" y1="33" x2="23.5" y2="28"/></g></svg>',fog:'<svg viewBox="0 0 40 40" fill="none"><line x1="6" y1="12" x2="34" y2="12" stroke="#93a8c0" stroke-width="2.5" stroke-linecap="round" opacity=".9"/><line x1="8" y1="19" x2="32" y2="19" stroke="#7a94ac" stroke-width="2.5" stroke-linecap="round" opacity=".7"/><line x1="11" y1="26" x2="29" y2="26" stroke="#607888" stroke-width="2.5" stroke-linecap="round" opacity=".5"/></svg>',moon:'<svg viewBox="0 0 40 40" fill="none"><circle cx="29" cy="8" r="1.2" fill="#f0d080" opacity=".9"/><circle cx="34" cy="17" r=".9" fill="#f0d080" opacity=".7"/><circle cx="7" cy="11" r="1" fill="#f0d080" opacity=".5"/><circle cx="19" cy="21" r="12" fill="#d4c060"/><circle cx="24" cy="18" r="10" fill="#e8f0fc"/></svg>',nightcloud:'<svg viewBox="0 0 40 40" fill="none"><circle cx="33" cy="7" r="1" fill="#f0d080" opacity=".8"/><circle cx="10" cy="10" r="7" fill="#d4c060"/><circle cx="13" cy="8" r="5.8" fill="#e8f0fc"/><rect x="8" y="24" width="26" height="12" rx="6" fill="#8899b4"/><ellipse cx="18" cy="24" rx="8" ry="7" fill="#99aac4"/><ellipse cx="27" cy="25" rx="7" ry="6" fill="#aabbd4"/></svg>',nightrain:'<svg viewBox="0 0 40 40" fill="none"><circle cx="9" cy="9" r="6" fill="#d4c060"/><circle cx="12" cy="7" r="5" fill="#e8f0fc"/><rect x="6" y="17" width="28" height="11" rx="5.5" fill="#5a7090"/><ellipse cx="17" cy="17" rx="8" ry="6.5" fill="#6a8090"/><ellipse cx="26" cy="18" rx="7" ry="5.5" fill="#7a90a0"/><g stroke="#3b82f6" stroke-width="2.2" stroke-linecap="round"><line x1="13" y1="30" x2="11" y2="37"/><line x1="20" y1="30" x2="18" y2="37"/><line x1="27" y1="30" x2="25" y2="37"/></g></svg>',shower:'<svg viewBox="0 0 40 40" fill="none"><circle cx="14" cy="12" r="5.5" fill="#f59e0b" opacity=".9"/><g stroke="#f59e0b" stroke-width="1.7" stroke-linecap="round"><line x1="14" y1="3" x2="14" y2="6"/><line x1="5" y1="12" x2="8" y2="12"/><line x1="8" y1="7" x2="10" y2="9"/><line x1="20" y1="7" x2="18" y2="9"/></g><rect x="9" y="18" width="22" height="11" rx="5.5" fill="#6a92b0"/><ellipse cx="17" cy="18" rx="6" ry="5.5" fill="#7aa2c0"/><ellipse cx="23" cy="19" rx="5" ry="4.5" fill="#8ab4d0"/><g stroke="#3b82f6" stroke-width="2.2" stroke-linecap="round"><line x1="19" y1="31" x2="17" y2="37"/></g></svg>',nightshower:'<svg viewBox="0 0 40 40" fill="none"><circle cx="9" cy="9" r="6" fill="#d4c060"/><circle cx="12" cy="7" r="5" fill="#e8f0fc"/><rect x="6" y="17" width="28" height="11" rx="5.5" fill="#5a7090"/><ellipse cx="17" cy="17" rx="8" ry="6.5" fill="#6a8090"/><ellipse cx="26" cy="18" rx="7" ry="5.5" fill="#7a90a0"/><g stroke="#3b82f6" stroke-width="2.2" stroke-linecap="round"><line x1="20" y1="30" x2="18" y2="36"/></g></svg>',nightsnow:'<svg viewBox="0 0 40 40" fill="none"><circle cx="9" cy="9" r="6" fill="#d4c060"/><circle cx="12" cy="7" r="5" fill="#e8f0fc"/><rect x="6" y="17" width="28" height="11" rx="5.5" fill="#7090b0"/><ellipse cx="17" cy="17" rx="8" ry="6.5" fill="#80a0c0"/><ellipse cx="26" cy="18" rx="7" ry="5.5" fill="#90b0d0"/><g stroke="#60a0d0" stroke-width="2" stroke-linecap="round"><line x1="13" y1="31" x2="13" y2="38"/><line x1="10" y1="33.5" x2="16" y2="35.5"/><line x1="10" y1="35.5" x2="16" y2="33.5"/><line x1="22" y1="31" x2="22" y2="38"/><line x1="19" y1="33.5" x2="25" y2="35.5"/><line x1="19" y1="35.5" x2="25" y2="33.5"/></g></svg>'};function quickFill(e){currentUseCase=e,document.getElementById("score-block").style.display="block";var t=document.getElementById("date-form");t&&t.classList.remove("uc-required");var n=document.getElementById("annual-wrap");n&&n.classList.remove("uc-required-ann");var a=document.getElementById("uc-hint");a&&(a.style.display="none");var l=document.getElementById("uc-hint-ann");l&&(l.style.display="none");var r=document.getElementById("inp-city"),o={plage:T.phBeach,ski:T.phSki};r.placeholder=o[e]||T.phDefault;var i=document.getElementById("mode-annual").classList.contains("active");if(i&&_lastMonthly&&_lastAnnLoc)renderAnnual(_lastAnnLoc,_lastMonthly);else if(!i&&_lastRows&&_lastSc){computeAndRenderScore(_lastSc,_lastRows);var s=document.getElementById("snow-depth-info");s&&(s.style.display="none"),"ski"===e&&s&&selectedLoc&&null!=window._lastYr&&fetchSnowDepth(selectedLoc.lat,selectedLoc.lon,window._lastYr,window._lastMo,window._lastDa).then(function(e){if(e){var t=e.elevation?Math.round(e.elevation):null;if(t&&t<600)s.textContent=T.snowAltLow.replace("{e}",t),s.style.color="#94a3b8";else if(null!=e.depth){var n=t?T.snowElevAt.replace("{e}",t):"";s.textContent=T.snowEst.replace("{d}",e.depth).replace("{e}",n),s.style.color="#6366f1"}else s.textContent=T.snowNA,s.style.color="#94a3b8";s.style.display="block"}})}else window===window.top&&r.focus(),selectedLoc=null;for(var c=document.querySelectorAll(".uc-pill[data-uc]"),u=0;u<c.length;u++)c[u].classList.remove("active"),c[u].dataset.uc===e&&c[u].classList.add("active")}function toggleDetails(){var e=document.getElementById("details-toggle"),t=document.getElementById("details-panel").classList.toggle("open");e.classList.toggle("open",t),e.setAttribute("aria-expanded",t),t&&setTimeout(function(){e.scrollIntoView({behavior:"smooth",block:"start"})},80)}function fillUseCase(e){currentUseCase=e,document.getElementById("score-block").style.display="block",quickFill(e)}function getIcon(e,t,n,a,l,r,o){l=l||0,o=null!=o?o:t;var i=(r=r||0)>.1||null!=o&&o<=2&&l>.1;return n<15?l>7||a>70&&l>2?IC.storm:i&&a>15||t<=0&&a>20?IC.nightsnow:a>35&&l>=1.5?IC.nightrain:a>20&&l>=.3?IC.nightshower:n<5?IC.moon:IC.nightcloud:l>7||a>70&&l>2?IC.storm:i&&a>15||t<=0&&a>20?IC.snow:a>55&&l>=3?IC.heavyrain:a>35&&l>=1.5?IC.rain:a>20&&l>=.3&&n>=200?IC.shower:a>20&&l>=.3?IC.lightrain:n<60&&t<8?IC.fog:n<130?IC.cloud:n<420?IC.partcloud:IC.sun}function getLabel(e,t,n,a,l,r,o){l=l||0,o=null!=o?o:t;var i=(r=r||0)>.1||o<=2&&l>.1;return n<15?l>7||a>70&&l>2?T.storm:i&&a>15||t<=0&&a>20?T.snow:a>35&&l>=1.5?T.rain:a>20&&l>=.3?T.showers:n<5?T.clearNight:T.cloudyNight:l>7||a>70&&l>2?T.storm:i&&a>15||t<=0&&a>20?T.snow:a>55&&l>=3?T.heavyRain:a>35&&l>=1.5?T.rain:a>20&&l>=.3&&n>=200?T.showers:a>20&&l>=.3?T.lightRain:n<60&&t<8?T.fog:n<130?T.overcast:n<420?T.partlyCloudy:T.sunny}function pct(e,t){if(!e||0===e.length)return null;var n=e.slice().sort(function(e,t){return e-t}),a=t/100*(n.length-1),l=Math.floor(a),r=Math.ceil(a);return parseFloat((n[l]+(n[r]-n[l])*(a-l)).toFixed(1))}function cloneRow(e,t){for(var n={},a=Object.keys(e),l=Object.keys(t),r=0;r<a.length;r++)n[a[r]]=e[a[r]];for(var o=0;o<l.length;o++)n[l[o]]=t[l[o]];return n}function genMain(e){for(var t=[],n=0;n<e.length;n++){var a=e[n];t.push(cloneRow(a,{temp:a.p50,sol:a.solP50||0}))}return t}var _seededRand=null;function seedRand(e){var t=0|e;_seededRand=function(){return t=Math.imul(t^t>>>15,1|t),(((t^=t+Math.imul(t^t>>>7,61|t))^t>>>14)>>>0)/4294967296}}function seededRand(){return _seededRand?_seededRand():Math.random()}function makeSeed(e,t,n,a,l){return Math.abs(1e5*Math.round(1e3*e)+100*Math.round(1e3*t)+1e4*n+100*a+l)}function genPess(e){for(var t=[],n=0;n<e.length;n++){var a=e[n];t.push(cloneRow(a,{temp:null!=a.p25?parseFloat((a.p25-seededRand()).toFixed(1)):a.p50,sol:Math.max(0,.4*(a.solP25||0)),rain:Math.min(100,Math.round(1.5*a.rain+10))}))}return t}function genOpt(e){for(var t=[],n=0;n<e.length;n++){var a=e[n];t.push(cloneRow(a,{temp:null!=a.p75?parseFloat((a.p75+seededRand()).toFixed(1)):a.p50,sol:Math.min(900,1.4*(a.solP75||0)),rain:Math.max(0,Math.round(.35*a.rain))}))}return t}function toISO(e){var t=e.getMonth()+1,n=e.getDate();return e.getFullYear()+"-"+(t<10?"0":"")+t+"-"+(n<10?"0":"")+n}function addDays(e,t){var n=new Date(e.getTime());return n.setDate(n.getDate()+t),n}function setP(e,t){document.getElementById("prog-bar").style.width=e+"%",document.getElementById("prog-pct").textContent=e+"%",t&&(document.getElementById("prog-lbl").textContent=t)}function lunarPhase(e,t,n){var a=e,l=t;l<=2&&(a-=1,l+=12);var r,o,i=Math.floor(a/100),s=2-i+Math.floor(i/4),c=(Math.floor(365.25*(a+4716))+Math.floor(30.6001*(l+1))+n+s-1524.5-2461057.5375)%29.53058867;return c<0&&(c+=29.53058867),c<1.85?(r=T.moonNew,o='<svg viewBox="0 0 24 24" width="22" height="22"><circle cx="12" cy="12" r="9" fill="#c8d8f0" opacity=".25" stroke="rgba(26,31,46,.3)" stroke-width="1"/><circle cx="12" cy="12" r="9" fill="#1a2a3a" opacity=".7"/></svg>'):c<7.38?(r=T.moonWaxCrescent,o='<svg viewBox="0 0 24 24" width="22" height="22"><circle cx="12" cy="12" r="9" fill="#c8d8f0" opacity=".15"/><path d="M12 3 A9 9 0 0 1 12 21 A5 9 0 0 0 12 3 Z" fill="#f0e8a0" opacity=".9"/></svg>'):c<9.22?(r=T.moonFirstQ,o='<svg viewBox="0 0 24 24" width="22" height="22"><circle cx="12" cy="12" r="9" fill="#1a2a3a" opacity=".5"/><path d="M12 3 A9 9 0 0 1 12 21 Z" fill="#f0e8a0" opacity=".9"/></svg>'):c<14.77?(r=T.moonWaxGibbous,o='<svg viewBox="0 0 24 24" width="22" height="22"><circle cx="12" cy="12" r="9" fill="#f0e8a0" opacity=".9"/><path d="M12 3 A9 9 0 0 0 12 21 A3 9 0 0 1 12 3 Z" fill="#1a2a3a" opacity=".6"/></svg>'):c<16.61?(r=T.moonFull,o='<svg viewBox="0 0 24 24" width="22" height="22"><circle cx="12" cy="12" r="9" fill="#f0e8a0" opacity=".95"/><circle cx="9" cy="10" r="1.5" fill="#d4c060" opacity=".4"/><circle cx="15" cy="14" r="1" fill="#d4c060" opacity=".3"/><circle cx="11" cy="15" r="1.2" fill="#d4c060" opacity=".35"/></svg>'):c<22.15?(r=T.moonWanGibbous,o='<svg viewBox="0 0 24 24" width="22" height="22"><circle cx="12" cy="12" r="9" fill="#f0e8a0" opacity=".9"/><path d="M12 3 A9 9 0 0 1 12 21 A3 9 0 0 0 12 3 Z" fill="#1a2a3a" opacity=".6"/></svg>'):c<23.99?(r=T.moonLastQ,o='<svg viewBox="0 0 24 24" width="22" height="22"><circle cx="12" cy="12" r="9" fill="#1a2a3a" opacity=".5"/><path d="M12 3 A9 9 0 0 0 12 21 Z" fill="#f0e8a0" opacity=".9"/></svg>'):(r=T.moonWanCrescent,o='<svg viewBox="0 0 24 24" width="22" height="22"><circle cx="12" cy="12" r="9" fill="#c8d8f0" opacity=".15"/><path d="M12 3 A9 9 0 0 0 12 21 A5 9 0 0 1 12 3 Z" fill="#f0e8a0" opacity=".9"/></svg>'),{phase:c,name:r,svg:o}}function sunriseSunset(e,t,n,a,l){var r=Math.floor(275*a/9)-Math.floor((a+9)/12)*(1+Math.floor((n-4*Math.floor(n/4)+2)/3))+l-30,o=t/15;function i(t){var n=t?r+(6-o)/24:r+(18-o)/24,a=.9856*n-3.289,l=a*Math.PI/180,i=a+1.916*Math.sin(l)+.02*Math.sin(2*l)+282.634,s=(i=(i%360+360)%360)*Math.PI/180,c=180*Math.atan(.91764*Math.tan(s))/Math.PI;c=((c=(c%360+360)%360)+90*Math.floor(i/90)-90*Math.floor(c/90))/15;var u=.39782*Math.sin(s),d=Math.cos(Math.asin(u)),m=(Math.cos(90.833*Math.PI/180)-u*Math.sin(e*Math.PI/180))/(d*Math.cos(e*Math.PI/180));return m>1||m<-1?null:(((t?(360-180*Math.acos(m)/Math.PI)/15:180*Math.acos(m)/Math.PI/15)+c-.06571*n-6.622-o)%24+24)%24}function s(e){if(null==e)return"--:--";var t=Math.floor(e),n=Math.floor(60*(e-t));return(t<10?"0":"")+t+"h"+(n<10?"0":"")+n}return{rise:s(i(!0)),set:s(i(!1))}}function applyTzOffset(e,t){if(!e||"--:--"===e)return e;var n=e.split("h"),a=60*parseInt(n[0])+parseInt(n[1]||0)+Math.round(t/60);a=(a%1440+1440)%1440;var l=Math.floor(a/60),r=a%60;return(l<10?"0":"")+l+"h"+(r<10?"0":"")+r}function renderAstro(e,t,n,a,l){var r=lunarPhase(n,a+1,l),o=sunriseSunset(e,t,n,a+1,l),i=void 0!==_locTzOffset?_locTzOffset:0,s=applyTzOffset(o.rise,i),c=applyTzOffset(o.set,i),u=0===i?"UTC":(i>0?"UTC+":"UTC")+(i/3600).toFixed(1).replace(".0","");document.getElementById("astro-moon-ico").innerHTML=r.svg,document.getElementById("astro-moon-name").textContent=r.name,document.getElementById("astro-rise").textContent=s,document.getElementById("astro-set").textContent=c;document.getElementById("astro-rise").parentElement&&document.getElementById("astro-rise").nextElementSibling;for(var d=document.querySelectorAll(".astro-lbl"),m=0;m<d.length;m++)d[m].textContent.indexOf("Lever")>=0&&(d[m].textContent=T.sunrise+" ("+u+")"),d[m].textContent.indexOf("Coucher")>=0&&(d[m].textContent=T.sunset+" ("+u+")")}function applyHorizonWording(e){var t=document.getElementById("r-horizon-label"),n=document.getElementById("btn-go"),a=(n.querySelector("span"),document.getElementById("btn-go-text"));0===e?(t.className="hero-horizon-label hl-real",t.textContent=T.modeToday,a&&(a.textContent=T.checkWeather)):e>=1&&e<=7?(t.className="hero-horizon-label hl-real",t.textContent=T.modeLive,a&&(a.textContent=T.checkWeather)):e<=210?(t.className="hero-horizon-label hl-tendency",t.textContent=T.modeEcmwf,a&&(a.textContent=T.checkWeather)):(t.className="hero-horizon-label hl-profile",t.textContent=T.modeClimate,a&&(a.textContent=T.checkWeather))}function setConfBadge(e){}function geocode(e){var t=e.replace(/\s*\([^)]*\)/g,"").split(",")[0].trim();return fetch("https://geocoding-api.open-meteo.com/v1/search?name="+encodeURIComponent(t)+"&count=5&language=fr").then(function(e){return e.json()}).then(function(e){if(!e.results||!e.results.length)throw new Error("Ville introuvable");var t=e.results[0],n="FR"===t.country_code?"":t.admin1||"";return{lat:t.latitude,lon:t.longitude,name:t.name,region:n,country:t.country||COUNTRY_NAMES[t.country_code]||t.country_code||""}})}var SEA_NAME_MAP=CFG.seaNameMap;function slugFromName(e){var t=CFG.slugNormalize(e);return SEA_NAME_MAP[t]||(SEA_CLIM_DATA[t]?t:null)}var SEA_CLIM_DATA=CFG.seaClimData;function getSeaComfortFR(e){return e>=28?{lbl:T.seaVeryWarm,color:"#ef4444"}:e>=24?{lbl:T.seaWarm,color:"#f59e0b"}:e>=20?{lbl:T.seaPleasant,color:"#16a34a"}:e>=17?{lbl:T.seaCool,color:"#0ea5e9"}:e>=14?{lbl:T.seaCold,color:"#6366f1"}:{lbl:T.seaVeryCold,color:"#64748b"}}function fetchMarineSST(e,t,n,a,l,r){var o=n+"-"+(a<9?"0":"")+(a+1)+"-"+(l<10?"0":"")+l,i=new Date;i.setHours(0,0,0,0);var s=new Date(n,a,l,0,0,0),c=Math.round((s.getTime()-i.getTime())/864e5);function u(){var n=r&&SEA_CLIM_DATA[r]?SEA_CLIM_DATA[r]:null;if(n&&null!==n[a])return Promise.resolve({sst:n[a],fallback:!0});var o=(new Date).getFullYear()-1;return fetch("https://marine-api.open-meteo.com/v1/marine?latitude="+e+"&longitude="+t+"&daily=sea_surface_temperature_max&start_date="+(o-2+"-"+(a<9?"0":"")+(a+1)+"-"+(l<10?"0":"")+l)+"&end_date="+(o+"-"+(a<9?"0":"")+(a+1)+"-"+(l<10?"0":"")+l)).then(function(e){return e.ok?e.json():null}).then(function(e){if(!e||!e.daily||!e.daily.sea_surface_temperature_max)return null;var t=e.daily.sea_surface_temperature_max.filter(function(e){return null!=e});if(!t.length)return null;t.sort(function(e,t){return e-t});var n=t[Math.floor(t.length/2)];return{sst:Math.round(10*n)/10,fallback:!0}}).catch(function(){return null})}var d,m=new Date(2024,0,1);return c>7||s<m?u():(d=0===c||c>=1&&c<=7?"https://marine-api.open-meteo.com/v1/marine?latitude="+e+"&longitude="+t+"&hourly=sea_surface_temperature&forecast_days=8":"https://marine-api.open-meteo.com/v1/marine?latitude="+e+"&longitude="+t+"&hourly=sea_surface_temperature&start_date="+o+"&end_date="+o,fetch(d).then(function(e){return e.ok?e.json():null}).then(function(e){if(!e||e.error)return u();var t=e.hourly&&e.hourly.sea_surface_temperature||[],n=e.hourly&&e.hourly.time||[],a=null;if(0===c){for(var l=o.slice(0,13),r=0;r<n.length;r++)if(0===n[r].indexOf(l)&&null!=t[r]){a=t[r];break}if(null===a)for(var i=0;i<t.length;i++)if(null!=t[i]){a=t[i];break}}else if(c>=1&&c<=7){for(l=o+"T12",r=0;r<n.length;r++)if(0===n[r].indexOf(l)&&null!=t[r]){a=t[r];break}if(null===a)for(i=0;i<t.length;i++)if(null!=t[i]){a=t[i];break}}else for(var s=0;s<t.length;s++)if(null!=t[s]){a=t[s];break}return null===a?u():{sst:Math.round(10*a)/10,fallback:!1}}).catch(function(){return u()}))}function renderSeaChip(e){if(e&&null!==e.sst){var t=getSeaComfortFR(e.sst),n=e.fallback?T.seaLabelSeasonal:T.seaLabel,a=document.createElement("div");a.className="score-chip",a.id="sea-chip",a.title=t.lbl,a.innerHTML='<span class="score-chip-dot" style="background:'+t.color+'"></span><span class="score-chip-lbl">'+n+'</span><span class="score-chip-val">'+fmtTemp(e.sst)+"</span>";var l=document.getElementById("score-chips");l&&l.appendChild(a)}}function fetchForecast(e,t,n,a,l){return fetch("https://api.open-meteo.com/v1/forecast?latitude="+e+"&longitude="+t+"&hourly=temperature_2m,precipitation_probability,precipitation,snowfall,windspeed_10m,shortwave_radiation&daily=weather_code,temperature_2m_max,temperature_2m_min,precipitation_probability_max,precipitation_sum&timezone=auto&forecast_days=8").then(function(e){if(!e.ok)throw new Error(T.errForecast);return e.json()}).then(function(e){null!=e.utc_offset_seconds&&(_locTzOffset=e.utc_offset_seconds),window._forecastDaily=e.daily||null;for(var t=a+1,r=n+"-"+(t<10?"0":"")+t+"-"+(l<10?"0":"")+l,o=[],i=0;i<24;i++){for(var s=r+"T"+(i<10?"0":"")+i+":00",c=-1,u=0;u<e.hourly.time.length;u++)if(e.hourly.time[u]===s){c=u;break}var d=c>=0&&null!=e.hourly.temperature_2m[c]?parseFloat(e.hourly.temperature_2m[c].toFixed(1)):null,m=c>=0&&null!=e.hourly.precipitation_probability[c]?e.hourly.precipitation_probability[c]:0,p=c>=0&&e.hourly.precipitation&&null!=e.hourly.precipitation[c]?parseFloat(e.hourly.precipitation[c].toFixed(2)):0,h=c>=0&&e.hourly.snowfall&&null!=e.hourly.snowfall[c]?parseFloat(e.hourly.snowfall[c].toFixed(2)):0,f=c>=0&&null!=e.hourly.windspeed_10m[c]?parseFloat(e.hourly.windspeed_10m[c].toFixed(1)):0,y=c>=0&&e.hourly.shortwave_radiation&&null!=e.hourly.shortwave_radiation[c]?Math.max(0,e.hourly.shortwave_radiation[c]):0;o.push({h:i,label:(i<10?"0":"")+i+"h",p25:d,p50:d,p75:d,temp:d,rain:m,mm:p,windP50:f,solP25:y,solP50:y,solP75:y,sol:y,snow:h,isForecast:!0})}return o})}function wmoIcon(e,t,n){return null!=t&&t<.2&&(null==n||n<20)&&e>=51&&(e=e>=45&&e<=48?45:2),0===e?"‚òÄÔ∏è":e<=2?"‚õÖ":3===e?"‚òÅÔ∏è":45===e||48===e?"üå´Ô∏è":e>=51&&e<=57?"üå¶Ô∏è":e>=61&&e<=67?"üåßÔ∏è":e>=71&&e<=77?"üå®Ô∏è":e>=80&&e<=82?"üå¶Ô∏è":e>=85&&e<=86?"üå®Ô∏è":e>=95?"‚õàÔ∏è":"‚õÖ"}function render7DayStrip(e){var t=document.getElementById("forecast-strip");if(t){var n=window._forecastDaily;if(!n||!n.time||n.time.length<2)t.style.display="none";else if(null!=e&&0===e){var a='<div class="fs-label">'+(T.forecast7dLabel||"Pr√©visions 7 jours")+'</div><div class="fs-row">',l=CFG.dateLocale||"fr-FR",r=(new Date).toISOString().slice(0,10),o=n.time.indexOf(r);o<0&&(o=0);for(var i=Math.min(n.time.length-o,8),s=0;s<i;s++){var c=o+s,u=n.time[c].split("-"),d=new Date(parseInt(u[0]),parseInt(u[1])-1,parseInt(u[2])),m=0===s?T.dayToday||"Auj.":d.toLocaleDateString(l,{weekday:"short"}).replace(".",""),p=null!=n.temperature_2m_max[c]?Math.round(n.temperature_2m_max[c]):"‚Äì",h=null!=n.temperature_2m_min[c]?Math.round(n.temperature_2m_min[c]):"‚Äì",f=n.weather_code&&n.weather_code[c]||0,y=n.precipitation_probability_max&&n.precipitation_probability_max[c]||0,g=n.precipitation_sum&&n.precipitation_sum[c]||0,v=g>5?"fs-rain-heavy":g>.5?"fs-rain-light":y>40?"fs-rain-maybe":"";a+='<div class="fs-day'+(s===e?" fs-active":"")+'">',a+='<span class="fs-day-name">'+m+"</span>",a+='<span class="fs-day-icon">'+wmoIcon(f,g,y)+"</span>",a+='<span class="fs-day-temp">'+fmtTempRaw(p)+"¬∞</span>",a+='<span class="fs-day-min">'+fmtTempRaw(h)+"¬∞</span>",v&&(a+='<span class="fs-rain-bar '+v+'"></span>'),a+="</div>"}a+="</div>",t.innerHTML=a,t.style.display="block"}else t.style.display="none"}}function fetchArchive(e,t,n){var a=toISO(addDays(n,-10)),l=toISO(addDays(n,10));return fetch("https://archive-api.open-meteo.com/v1/archive?latitude="+e+"&longitude="+t+"&start_date="+a+"&end_date="+l+"&hourly=temperature_2m,precipitation,snowfall,windspeed_10m,shortwave_radiation,relative_humidity_2m&timezone=auto").then(function(e){if(!e.ok)throw new Error("Archive error");return e.json()}).then(function(e){return null!=e.utc_offset_seconds&&(_locTzOffset=e.utc_offset_seconds),e})}function fetchSnowDepth(e,t,n,a,l){var r=(new Date).getFullYear()-1,o=toISO(addDays(new Date(r-9,a,l),-3)),i=toISO(addDays(new Date(r,a,l),3));return fetch("https://archive-api.open-meteo.com/v1/archive?latitude="+e+"&longitude="+t+"&start_date="+o+"&end_date="+i+"&daily=snow_depth_max&timezone=auto").then(function(e){return e.ok?e.json():null}).then(function(e){if(!e||!e.daily||!e.daily.snow_depth_max)return{depth:null,elevation:e?e.elevation:null};for(var t=e.daily.time,n=e.daily.snow_depth_max,r=[],o=0;o<t.length;o++)if(null!=n[o]){var i=t[o].split("-"),s=parseInt(i[1])-1,c=parseInt(i[2]);Math.abs(31*s+c-(31*a+l))<=3&&r.push(n[o])}var u=r.length?r.slice().sort(function(e,t){return e-t})[Math.floor(r.length/2)]:null;return{depth:null!=u?Math.round(100*u):null,elevation:e.elevation||null}}).catch(function(){return{depth:null,elevation:null}})}function buildClimatology(e,t,n,a,l){for(var r=new Date(n,a,l,12,0,0),o=new Date,i=.03*Math.max(0,(r.getTime()-o.getTime())/315576e5),s=o.getFullYear()-1,c=[],u=s-9;u<=s;u++)c.push(u);for(var d=[],m=0;m<24;m++)d.push({t:[],p:[],w:[],s:[],sn:[],rh:[]});var p=0;return function n(){if(p>=c.length)return Promise.resolve(buildRows(d,i));var r=c[p++];return fetchArchive(e,t,new Date(r,a,l,12,0,0)).then(function(e){for(var t=e.hourly.temperature_2m,n=e.hourly.precipitation,a=e.hourly.windspeed_10m,l=e.hourly.shortwave_radiation||[],r=e.hourly.snowfall||[],o=e.hourly.relative_humidity_2m||[],i=0;i<e.hourly.time.length;i++){var s=new Date(e.hourly.time[i]).getHours();null!=t[i]&&d[s].t.push(t[i]),null!=n[i]&&d[s].p.push(n[i]),null!=a[i]&&d[s].w.push(a[i]),null!=l[i]&&d[s].s.push(l[i]),null!=r[i]&&d[s].sn.push(r[i]),null!=o[i]&&d[s].rh.push(o[i])}}).catch(function(){}).then(function(){return setP(Math.round(p/c.length*90),"Analyse "+r+"‚Ä¶"),new Promise(function(e){setTimeout(e,20)})}).then(n)}()}function buildRows(e,t){for(var n=[],a=0;a<24;a++){for(var l=e[a],r=0,o=0;o<l.p.length;o++)l.p[o]>.1&&r++;var i=pct(l.t,25),s=pct(l.t,50),c=pct(l.t,75),u=l.sn&&l.sn.length>0?l.sn.reduce(function(e,t){return e+t},0)/l.sn.length:0,d=null!=s?s+t:null,m=null;if(null!=d&&l.t.length>0){for(var p=0,h=0;h<l.t.length;h++)Math.abs(l.t[h]-d)<=2&&p++;m=Math.round(p/l.t.length*100)}var f=l.rh&&l.rh.length>0?l.rh.reduce(function(e,t){return e+t},0)/l.rh.length:null;n.push({h:a,label:(a<10?"0":"")+a+"h",p25:null!=i?parseFloat((i+t).toFixed(1)):null,p50:d,p75:null!=c?parseFloat((c+t).toFixed(1)):null,temp:d,rain:l.p.length>0?Math.round(r/l.p.length*100):0,mm:l.p.length>0?l.p.reduce(function(e,t){return e+t},0)/l.p.length:0,snow:u,windP50:pct(l.w,50),solP25:Math.max(0,pct(l.s,25)||0),solP50:Math.max(0,pct(l.s,50)||0),solP75:Math.max(0,pct(l.s,75)||0),sol:Math.max(0,pct(l.s,50)||0),tempFreq:m,rh:f})}return n}function fetchSeasonal(e,t,n,a,l){var r=a+1,o=n+"-"+((r<10?"0":"")+r)+"-"+((l<10?"0":"")+l);return fetch("https://seasonal-api.open-meteo.com/v1/seasonal?latitude="+e+"&longitude="+t+"&daily=temperature_2m_mean,precipitation_sum,windspeed_10m_mean&start_date="+o+"&end_date="+o).then(function(e){return e.ok?e.json():null}).then(function(e){if(!e||!e.daily||!e.daily.time||e.daily.time[0]!==o)return null;for(var t=e.daily,n=Object.keys(t),a=[],l=[],r=[],i=0;i<n.length;i++){var s=n[i];0===s.indexOf("temperature_2m_mean_member")&&null!=t[s][0]&&a.push(t[s][0]),0===s.indexOf("precipitation_sum_member")&&null!=t[s][0]&&l.push(t[s][0]),0===s.indexOf("windspeed_10m_mean_member")&&null!=t[s][0]&&r.push(t[s][0])}if(!a.length)return null;a.sort(function(e,t){return e-t}),l.sort(function(e,t){return e-t});for(var c=a.length,u=0,d=0;d<l.length;d++)l[d]>.1&&u++;for(var m=0,p=0;p<r.length;p++)m+=r[p];return{tMean:t.temperature_2m_mean[0]||a[Math.floor(.5*c)],tP25:a[Math.floor(.25*c)],tP50:a[Math.floor(.5*c)],tP75:a[Math.floor(.75*c)],rainProb:l.length?Math.round(u/l.length*100):null,windMean:r.length?m/r.length:null}}).catch(function(){return null})}function applySeasonalCorrection(e,t){if(!t)return e;for(var n=0,a=0,l=0,r=0,o=0,i=0,s=0;s<e.length;s++){var c=e[s];null!=c.p50&&(n+=c.p50,a++),l+=c.rain,c.windP50&&(r+=c.windP50),null!=c.p25&&null!=c.p75&&(o+=(c.p75-c.p25)/2,i++)}if(!a)return e;var u=n/a,d=parseFloat((t.tMean-u).toFixed(2));window._seasTempOffset=d,window._seasRainOffset=null!=t.rainProb?Math.round(t.rainProb-l/e.length):null;for(var m=i?o/i:1,p=(t.tP75-t.tP25)/2,h=m>.5&&p>0?Math.min(2.5,Math.max(.3,p/m)):1,f=l/e.length,y=e.length?r/e.length:0,g=[],v=0;v<e.length;v++){var x=e[v],T=null!=x.p50?x.p50+d:null,w=null!=x.p50&&null!=x.p25?x.p50-x.p25:0,M=null!=x.p50&&null!=x.p75?x.p75-x.p50:0,b=x.rain;if(null!==t.rainProb){var C=t.rainProb-f;b=Math.min(100,Math.max(0,Math.round(x.rain+.25*C)))}var _=x.windP50;if(null!==t.windMean&&null!=x.windP50){var I=Math.min(5,Math.max(-5,.35*(t.windMean-y)));_=Math.max(0,parseFloat((x.windP50+I).toFixed(1)))}g.push(cloneRow(x,{p50:null!=T?parseFloat(T.toFixed(1)):null,p25:null!=T?parseFloat((T-w*h).toFixed(1)):null,p75:null!=T?parseFloat((T+M*h).toFixed(1)):null,temp:null!=T?parseFloat(T.toFixed(1)):null,sol:x.solP50||0,rain:b,windP50:_}))}return g}function showSection(e){document.getElementById(e).style.display="block"}function hideSection(e){document.getElementById(e).style.display="none"}function renderHourly(e){var t=document.getElementById("h-strip");t.innerHTML="";for(var n=[0,3,6,9,12,15,18,21,23],a=0;a<n.length;a++){var l=e[n[a]];if(l){var r=23===n[a]?"00h":l.label,o=document.createElement("div");o.className="h-cell",o.innerHTML='<span class="h-hr">'+r+'</span><span class="h-ic">'+getIcon(l.h,l.temp,l.sol,l.rain,l.mm||0,l.snow||0,l.p25)+'</span><span class="h-tp">'+(null!=l.temp?fmtTempRaw(l.temp)+"¬∞":"-")+'</span><span class="h-lb">'+getLabel(l.h,l.temp,l.sol,l.rain,l.mm||0,l.snow||0)+'</span><div class="h-rb"><div class="h-rf" style="width:'+l.rain+'%"></div></div>',t.appendChild(o)}}}function scenarioLabel(e,t){for(var n=[],a=[],l=0;l<e.length;l++)null!=e[l].temp&&n.push(e[l].temp),a.push(e[l].rain);var r,o,i=n.length?Math.max.apply(null,n):null,s=n.length?Math.min.apply(null,n):null,c=a.length?a.reduce(function(e,t){return e+t},0)/a.length:0;return t?null!==i&&i>=38?(r=T.heroVeryHot,o=T.heroVeryHotSub):null!==i&&i>=32?(r=T.heroHotDay,o=T.heroHotDaySub):null!==i&&i<=5?(r=T.heroColdDay,o=T.heroColdDaySub):c<=15?(r=T.heroIdealDay,o=T.heroIdealDaySub):(r=T.heroGoodDay,o=T.heroGoodDaySub):c>=60?(r=T.heroVeryRainy,o=T.heroVeryRainySub):null!==i&&i>=38?(r=T.heroCanicule,o=T.heroChaniculeSub):null!==s&&s<=0?(r=T.heroFreezing,o=T.heroFreezingSub):c>=35?(r=T.heroDifficult,o=T.heroDifficultSub):(r=T.heroMixed,o=T.heroMixedSub),{title:r,sub:o}}function updateScenarioLabels(e,t){var n=scenarioLabel(e,!1),a=scenarioLabel(t,!0),l=document.getElementById("sc-pess-ttl"),r=document.getElementById("sc-pess-sub"),o=document.getElementById("sc-opt-ttl"),i=document.getElementById("sc-opt-sub");l&&(l.textContent=n.title),r&&(r.textContent=n.sub),o&&(o.textContent=a.title),i&&(i.textContent=a.sub)}function renderScCard(e,t,n){var a=document.getElementById(t);a.innerHTML="";for(var l=[0,3,6,9,12,15,18,21,23],r=0;r<l.length;r++){var o=e[l[r]];if(o){var i=23===l[r]?"00h":o.label,s=document.createElement("div");s.className="sc-cell",s.innerHTML='<span class="sc-hr">'+i+"</span>"+getIcon(o.h,o.temp,o.sol,o.rain,o.mm||0,o.snow||0,o.p25)+'<span class="sc-tp">'+(null!=o.temp?fmtTempRaw(o.temp)+"¬∞":"-")+"</span>",a.appendChild(s)}}for(var c=[],u=0,d=0,m=0;m<e.length;m++)null!=e[m].temp&&c.push(e[m].temp),u+=e[m].rain,d+=e[m].windP50||0;var p=c.length?Math.min.apply(null,c):"-",h=c.length?Math.max.apply(null,c):"-";document.getElementById(n).innerHTML='<div><div class="sc-stat-val">'+fmtTempRaw(p)+"¬∞/"+fmtTempRaw(h)+'¬∞</div><div class="sc-stat-lbl">'+T.statMinMax+'</div></div><div><div class="sc-stat-val">'+Math.round(u/e.length)+'%</div><div class="sc-stat-lbl">'+T.statRain+'</div></div><div><div class="sc-stat-val">'+fmtWind(Math.round(d/e.length))+'</div><div class="sc-stat-lbl">'+T.statWind+"</div></div>"}var currentUseCase="general",_lastRows=null,_lastSc=null,_locTzOffset=0,_lastMonthly=null,_lastAnnLoc=null,MONTHLY_CACHE=null,MONTHLY_CACHE_PROMISE=fetch(CFG.dataBase+"data/monthly.json").then(function(e){return e.ok?e.json():null}).then(function(e){return MONTHLY_CACHE=e||{}}).catch(function(){return MONTHLY_CACHE={},{}});function findCachedMonthly(e,t){if(!MONTHLY_CACHE)return null;var n=e+","+t;if(MONTHLY_CACHE[n])return MONTHLY_CACHE[n].monthly;var a=null,l=.15;for(var r in MONTHLY_CACHE){var o=r.split(","),i=Math.sqrt(Math.pow(parseFloat(o[0])-e,2)+Math.pow(parseFloat(o[1])-t,2));i<l&&(l=i,a=r)}return a?MONTHLY_CACHE[a].monthly:null}var UC_CONFIG={general:{label:T.ucGeneral,tempMin:16,tempMax:28,weights:{rain:30,temp:35,wind:15,sun:20}},plage:{label:"Plage & baignade",tempMin:22,tempMax:38,weights:{rain:30,temp:45,wind:10,sun:15}},ski:{label:"Ski & sports d'hiver",tempMin:-8,tempMax:2,weights:{rain:20,temp:40,wind:10,sun:30}}},TROPICAL_KEYS={"-8.67,115.21":!0,"13.75,100.52":!0,"9.93,-84.08":!0,"15.49,73.82":!0,"15.88,108.33":!0,"-20.35,57.55":!0,"18.1,-77.3":!0,"23.14,-82.36":!0,"3.2,73.22":!0,"7.88,98.39":!0,"-21.11,55.54":!0,"-22.9,-43.17":!0,"20.62,-87.08":!0,"-4.68,55.49":!0,"13.36,103.86":!0,"1.35,103.82":!0,"-6.16,39.2":!0,"13.19,-59.54":!0,"-1.29,36.82":!0,"-18.88,47.51":!0,"18.79,98.98":!0,"9.51,100.06":!0,"21.03,105.85":!0,"10.82,106.63":!0,"22.32,114.17":!0,"14.6,120.98":!0,"3.14,101.69":!0,"26.92,75.79":!0,"7.87,80.77":!0,"16.25,-61.55":!0,"14.64,-61.02":!0,"18.47,-69.9":!0,"18.58,-68.4":!0,"4.6,-74.08":!0,"-17.53,-149.57":!0,"-16.5,-151.74":!0,"14.5,-14.45":!0,"14.93,-23.51":!0,"-6.37,35.75":!0,"8.09,98.91":!0,"7.53,99.04":!0,"20.91,107.18":!0,"16.05,108.22":!0,"10.23,103.97":!0,"-8.65,116.32":!0,"-7.8,110.36":!0,"-8.51,115.26":!0,"10.21,118.99":!0,"19.86,102.14":!0,"10.85,76.27":!0,"28.61,77.21":!0,"25.05,-77.35":!0,"13.91,-60.98":!0,"18.07,-63.05":!0,"20.63,-87.08":!0,"20.65,-105.23":!0,"8.98,-79.52":!0,"6.25,-75.56":!0,"-0.95,-90.97":!0,"-17.71,177.99":!0,"-22.28,166.46":!0,"-12.78,45.23":!0,"25.03,121.57":!0,"17.9,-62.83":!0,"11.19,119.39":!0,"12.57,104.99":!0,"7.74,98.78":!0,"10.1,99.84":!0,"12.93,100.88":!0,"-8.35,116.04":!0,"-8.73,115.54":!0,"-8.55,119.49":!0,"26.33,127.8":!0,"10.32,123.89":!0,"11.97,121.92":!0,"6.35,99.73":!0,"5.42,100.33":!0,"16.87,96.2":!0,"19.89,102.13":!0,"12.17,-68.98":!0,"12.51,-69.97":!0,"18.47,-66.11":!0,"10.65,-61.5":!0,"17.12,-61.85":!0,"17.06,-96.73":!0,"14.63,-90.51":!0,"17.25,-88.77":!0,"12.11,-86.27":!0,"-0.18,-78.47":!0,"-16.92,145.77":!0,"-19.72,63.43":!0,"-13.33,48.27":!0,"11.94,108.44":!0,"-8.66,115.13":!0,"4.94,-52.33":!0,"-4.28,39.58":!0,"14.69,-17.44":!0,"12.24,109.19":!0,"9.85,126.05":!0,"4.97,115.06":!0,"22.2,113.54":!0,"11.56,104.92":!0,"4.71,-74.07":!0,"21.52,-87.38":!0,"-4.04,39.67":!0,"5.56,-0.19":!0,"5.36,-4.01":!0,"-1.94,30.06":!0,"-6.16,39.19":!0,"0.35,32.58":!0,"6.52,3.38":!0,"-6.79,39.28":!0,"19.08,72.88":!0,"6.93,79.84":!0,"-12.97,-38.51":!0,"10.39,-75.51":!0,"25.05,-77.34":!0,"21.77,-72.34":!0,"-12.46,130.84":!0,"-13.83,-171.76":!0,"-17.73,168.32":!0,"-21.21,-175.15":!0,"16.46,107.6":!0,"-25.97,32.57":!0,"11.93,79.83":!0,"21.31,-157.86":!0,"-21.24,-159.78":!0,"-25.69,-54.44":!0,"10.31,-84.82":!0,"8.48,-13.23":!0,"12.37,-1.52":!0,"6.37,2.39":!0,"6.13,1.22":!0,"4.05,9.77":!0,"0.42,33.21":!0,"-2.27,40.9":!0,"-23.75,35.54":!0,"-0.23,130.52":!0,"-8.49,119.88":!0,"19.91,99.83":!0,"20.25,105.97":!0,"12.0,120.2":!0,"13.1,103.2":!0,"17.1,121.55":!0,"22.63,120.3":!0,"15.33,76.46":!0,"9.93,76.26":!0,"6.87,81.05":!0,"20.8,-156.32":!0,"15.41,-61.37":!0,"12.14,-68.26":!0,"13.01,-61.23":!0,"16.32,-86.53":!0,"11.93,-85.96":!0,"-3.12,-60.02":!0,"-20.28,148.95":!0,"-17.53,-149.83":!0,"-6.31,147.18":!0,"16.73,-22.93":!0,"12.47,53.87":!0},SCORE_RANGES_FICHE={avoid:[.5,3.9],mid:[4,6.9],rec:[7,10]};function tIdeal(e){return e<=5?0:e<=14?(e-5)/9*.3:e<=22?.3+(e-14)/8*.5:e<=28?.8+(e-22)/6*.2:e<=35?1-(e-28)/7*.4:Math.max(0,.6-(e-35)/10*.3)}function rawScoreFiche(e,t,n){return.4*tIdeal(e)+.35*Math.max(0,1-t/100)+.25*Math.min(1,n/15)}function autoClass(e){return e>=.55?"rec":e>=.38?"mid":"avoid"}function findFicheScores(e,t){var n=e+","+t;if(FICHE_SCORES[n])return[n,FICHE_SCORES[n]];var a=null,l=.15;for(var r in FICHE_SCORES){var o=r.split(","),i=Math.abs(parseFloat(o[0])-e),s=Math.abs(parseFloat(o[1])-t),c=Math.sqrt(i*i+s*s);c<l&&(l=c,a=r)}return a?[a,FICHE_SCORES[a]]:[null,null]}function computeAnchoredScores(e,t){var n=!!TROPICAL_KEYS[t];if(!e.every(function(e){return null!=e.ficheScore})){var a=e.map(function(e,t){var n=rawScoreFiche(null!=e.avgTmax?e.avgTmax:e.avgTemp||20,null!=e.rainPct?e.rainPct:30,null!=e.sunHrs?e.sunHrs:5);return{i:t,raw:n,cls:autoClass(n)}});["avoid","mid","rec"].forEach(function(t){var l=a.filter(function(e){return e.cls===t});if(l.length){var r=n&&"avoid"===t?SCORE_RANGES_FICHE.mid:SCORE_RANGES_FICHE[t],o=r[0],i=r[1],s=l.map(function(e){return e.raw}),c=Math.min.apply(null,s),u=Math.max.apply(null,s);l.forEach(function(t,n){if(null==e[t.i].ficheScore){var a=u!==c?(s[n]-c)/(u-c):.5;e[t.i].ficheScore=Math.round(10*(o+a*(i-o)))}})}})}}function scoreRain(e){return e<=10?100:e<=25?100-2*(e-10):e<=50?70-1.6*(e-25):e<=80?30-.8*(e-50):Math.max(0,6-.3*(e-80))}function scoreRainSmart(e,t,n){var a=e;if(null!=t)if(t<3)a=e*(.4+t/3*.3);else if(t<6){a=e*(.7+(t-3)/3*.3)}return scoreRain(a)}function scoreTemp(e,t,n){if(null==e)return 50;var a=(t+n)/2,l=(n-t)/2;return e>=t&&e<=n?100-20*Math.abs(e-a)/l:e<t?Math.max(0,80-8*(t-e)):Math.max(0,80-2*(e-n))}function scoreWind(e){return e<=10?100:e<=20?100-3*(e-10):e<=40?70-2.5*(e-20):Math.max(0,20-1*(e-40))}function scoreHumidity(e,t){if(null==e||null==t||t<24)return 0;if(e<=65)return 0;var n=Math.min(1,(t-24)/14),a=Math.min(1,(e-65)/30);return Math.round(20*n*a)}function scoreHumidityPlage(e,t){if(null==e||null==t||t<26)return 0;if(e<=75)return 0;var n=Math.min(1,(t-26)/12),a=Math.min(1,(e-75)/20);return Math.round(15*n*a)}function scoreSun(e){return e>=600?100:e>=300?60+(e-300)/300*40:e>=100?20+(e-100)/200*40:Math.max(0,e/100*20)}function getScoreColor(e){return e>=86?"#1a7a4a":e>=76?"#2d9e60":e>=63?"#84cc16":e>=50?"#f59e0b":e>=35?"#f97316":"#ef4444"}function getMainDriver(e,t,n,a,l,r,o){for(var i=UC_CONFIG[o]||UC_CONFIG.general,s=[{key:"rain",score:a,test:e>35},{key:"temp_cold",score:l,test:null!=t&&t<i.tempMin},{key:"temp_hot",score:l,test:null!=t&&t>i.tempMax},{key:"wind",score:r,test:n>28}],c=null,u=0;u<s.length;u++)s[u].test&&(!c||s[u].score<c.score)&&(c=s[u]);return c?{rain:T.drvRain,temp_cold:T.drvCold,temp_hot:"plage"===o?T.drvHotBeach:T.drvHotGen,wind:T.drvWind}[c.key]:null}function getVerdict(e,t,n,a,l,r){l=l||"general";var o,i=r?T.seasonalSuffix:"";o=e>=86?T.scIdeal:e>=76?T.scVeryGood:e>=63?T.scGood:e>=50?"Variable":e>=35?T.scPoor:T.scBad;var s=UC_CONFIG[l]||UC_CONFIG.general,c=getMainDriver(t,n,a,scoreRain(t),scoreTemp(n,s.tempMin,s.tempMax),scoreWind(a),l);return"ski"===l?o+" ¬∑ "+(e>=76?T.actGoodSnow:e>=50?T.actCautionThaw:T.actBadSnow)+i:"plage"===l?o+" ¬∑ "+(e>=76?T.actOptimalSwim:e>=50?c?T.actCautionBeach+" ‚Äî "+c:T.actCautionBeachFull:c?T.actPoorBeach+" ‚Äî "+c:T.actPoorBeachFull)+i:o+" ¬∑ "+(e>=76?c?T.actBookOk+" ‚Äî "+c+T.actResidual:T.actBookOk:e>=50?c?T.actPlanB+" ‚Äî "+c:T.actPlanBFull:c?T.actUnstable+" ‚Äî "+c:T.actUnstable)+i}function getMainRisk(e,t,n,a){var l=UC_CONFIG[a]||UC_CONFIG.general,r=[];return e>50?r.push(T.riskRainLikely.replace("{p}",Math.round(e))):e>30&&r.push(T.riskShowers.replace("{p}",Math.round(e))),t<l.tempMin?r.push(T.riskCoolTemp.replace("{t}",fmtTemp(t))):t>l.tempMax&&r.push(T.riskHighHeat.replace("{t}",fmtTemp(t))),n>30&&r.push(T.riskWind.replace("{w}",fmtWind(n))),0===r.length?T.riskNone:T.riskPrefix+r.join(" ¬∑ ")}function computeAndRenderScore(e,t){_lastRows=t,_lastSc=e;for(var n=currentUseCase,a=UC_CONFIG[n]||UC_CONFIG.general,l=a.weights,r=0,o=0,i=0,s=0,c=0,u=0,d=0;d<t.length;d++)r+=t[d].rain,o+=t[d].windP50||0,u+=t[d].mm||0,null!=t[d].temp&&(i+=t[d].temp,s++);for(var m=0;m<e.length;m++)(e[m].sol||0)>c&&(c=e[m].sol);for(var p=r/t.length,h=o/t.length,f=s?i/s:null,y=0,g=0,v=0;v<t.length;v++)null!=t[v].rh&&(y+=t[v].rh,g++);var x,w=g?y/g:null,M=scoreRainSmart(p,u,f),b=scoreTemp(f,a.tempMin,a.tempMax),C=scoreWind(h),_=scoreSun(c);if("ski"===n){var I,E=t.length?Math.max.apply(null,t.map(function(e){return e.temp||0})):f||10,k=t.length?Math.min.apply(null,t.map(function(e){return e.temp||0})):f||5,S=u/t.length;I=E>10?0:E>5?Math.max(0,50-10*(E-5)):E>=-2?90+2*(2-Math.abs(E)):E>=-12?90-3*(Math.abs(E)-2):Math.max(30,90-3*(Math.abs(E)-2));var B=k<0&&S>2?Math.min(100,60+3*S):k<0&&S>0?55:20,A=Math.min(100,c/50*8),F=E>2?Math.max(0,100-1.5*p):Math.max(40,100-.3*p);x=Math.round(.15*F+.4*I+.2*B+.25*A)}else if("plage"===n){var P,R=t.length?Math.max.apply(null,t.map(function(e){return e.temp||0})):f||20;P=R<18?0:R<22?(R-18)/4*20:R<26?20+(R-22)/4*60:R<=35?80+(R-26)/9*20:R<=40?100-(R-35)/5*30:Math.max(40,70-5*(R-40));var L=Math.max(0,100-1.8*p),D=Math.min(100,c/50*8),O=scoreHumidityPlage(w,f);x=Math.round(.35*L+.45*P+.2*D)-O}else{var H=scoreHumidity(w,f);x=Math.round(M*l.rain/100+b*l.temp/100+C*l.wind/100+_*l.sun/100)-H}var N=getScoreColor(x=Math.min(100,Math.max(0,x))),G=188.5*(1-x/100),U=document.getElementById("score-ring");U.style.stroke=N,setTimeout(function(){U.style.strokeDashoffset=G},50),document.getElementById("score-num").textContent=(x/10).toFixed(1)+"‚Ää/‚Ää10";var z={plage:T.ucScoreBeach,ski:T.ucScoreSki,general:T.ucScoreGeneral};"general"===n?(document.getElementById("score-usecase").textContent=T.ucScoreGeneral,document.getElementById("score-risk").innerHTML=T.clickProject):document.getElementById("score-usecase").textContent=z[n]||a.label;var Y=null!=window._lastDiff&&window._lastDiff>7;document.getElementById("score-verdict").textContent=getVerdict(x,p,f,h,n,Y),document.getElementById("score-verdict").style.color=N,updateScoreTooltip(n),document.getElementById("score-risk").textContent=getMainRisk(p,f,h,n);for(var W=Math.round(10*u)/10,j=0,q=0;q<t.length;q++)j+=t[q].snow||0;j=Math.round(10*j)/10;for(var V=[],Q=0;Q<t.length;Q++)null!=t[Q].p25&&null!=t[Q].p75&&(V.push(t[Q].p25),V.push(t[Q].p75));var Z=null,K=null;if(V.length>=4){V.sort(function(e,t){return e-t});var J=V[V.length-1]-V[0];J<=8?(Z=T.spreadStable,K="#1a7a4a"):J>=16&&(Z=T.spreadVariable,K="#f97316")}var X=[{lbl:T.statRain,val:Math.round(p)+"%",score:M},{lbl:T.chipPrecip,val:fmtPrecip(W>0?W:0),score:M},{lbl:T.chipTemp,val:null!=f?fmtTemp(f):"‚Äì",score:b},{lbl:T.chipWind,val:fmtWind(h),score:C}];if(j>.5&&X.push({lbl:T.chipSnow,val:j+" cm",score:0,color:"#6366f1"}),null!=w&&null!=f&&f>22){var $=Math.max(0,100-1.5*Math.max(0,w-50));X.push({lbl:T.chipHumidity,val:Math.round(w)+"%",score:$})}Z&&X.push({lbl:Z,val:"",score:-1,color:K,noDot:!0});var ee=document.getElementById("score-chips");ee.innerHTML="";for(var te=0;te<X.length;te++){var ne=X[te].color||getScoreColor(X[te].score),ae=document.createElement("div");ae.className="score-chip",ae.innerHTML=X[te].noDot?'<span class="score-chip-lbl" style="padding-left:2px">'+X[te].lbl+"</span>":'<span class="score-chip-dot" style="background:'+ne+'"></span><span class="score-chip-lbl">'+X[te].lbl+'</span><span class="score-chip-val">'+X[te].val+"</span>",ee.appendChild(ae)}window._lastSSTResult&&renderSeaChip(window._lastSSTResult)}function updateHero(e,t,n){for(var a=e[null!=n?n:13]||e[12],l=[],r=0;r<e.length;r++)null!=e[r].temp&&l.push(e[r].temp);for(var o=l.length?Math.min.apply(null,l):"-",i=l.length?Math.max.apply(null,l):"-",s=0,c=0,u=0,d=0;d<t.length;d++)s+=t[d].rain,c+=t[d].windP50||0;for(var m=0;m<e.length;m++)(e[m].sol||0)>u&&(u=e[m].sol);var p,h=Math.round(s/t.length);p=h>55?T.skyRainy:h>35?T.skyCloudy:u>500&&h<20?T.skyClearSky:u>250&&h<30?T.skySunny:u>80?T.skyHazy:u>15?T.skyCloudy:T.skyOvercast,window._heroTemp=a.temp||null,document.getElementById("r-temp").innerHTML=fmtTempRaw(a.temp||0)+"<sup>¬∞</sup>",document.getElementById("r-range").textContent=fmtTempRaw(o)+"¬∞ / "+fmtTempRaw(i)+"¬∞ "+T.duringDayShort;var f=document.getElementById("r-tempfreq"),y=(e[13]||e[12]||{}).tempFreq;null!=y&&f?(f.textContent=T.tempFreq.replace("{u}",fmtTempUnit()).replace("{t}",fmtTempRaw(a.temp||0)).replace("{p}",y),f.style.display="block"):f&&(f.style.display="none");var g=document.getElementById("r-seasinfo");if(g){var v=window._seasTempOffset,x=window._seasRainOffset;if(null!=v&&Math.abs(v)>=.3){var w=[(v>0?"+":"")+Math.round(10*v)/10+"¬∞ /ECMWF"];null!=x&&Math.abs(x)>=3&&w.push((x>0?"+":"")+x+"% "+T.wordRain),g.textContent=T.seasonalCorrection+" "+w.join(" ¬∑ "),g.style.display="block"}else g.style.display="none"}document.getElementById("r-cond").textContent=getLabel(a.h,a.temp,a.sol,a.rain,a.mm||0,a.snow||0,a.p25),document.getElementById("r-icon").innerHTML=getIcon(a.h,a.temp,a.sol,a.rain,a.mm||0,a.snow||0,a.p25),document.getElementById("r-rain").textContent=h+"%",document.getElementById("r-wind").textContent=fmtWind(Math.round(c/t.length)),document.getElementById("r-sky").textContent=p,computeAndRenderScore(e,t);var M=document.getElementById("snow-alert");if(!M){(M=document.createElement("div")).id="snow-alert",M.style.cssText="background:#ede9fe;border:1.5px solid #6366f1;border-radius:10px;padding:8px 14px;font-size:13px;font-weight:700;color:#4f46e5;display:none;margin-top:10px;text-align:center";var b=document.querySelector(".hero-top");b&&b.appendChild(M)}for(var C=t||e,_=0,I=0;I<C.length;I++)_+=C[I].snow||0;var E=0,k=-1;if(_<.5)for(I=0;I<C.length;I++){var S=C[I];((null!=S.p25?S.p25:S.temp)||99)<=2&&(S.mm||0)>.1&&(S.rain||0)>15&&(E++,k<0&&(k=S.h),S.h)}else for(I=0;I<C.length;I++)(C[I].snow||0)>0&&(k<0&&(k=C[I].h),C[I].h);var B,A=k>=0?(B=k)<0?"":B>=22||B<6?" ¬∑ la nuit":B<10?" ¬∑ le matin":B<14?T.duringDay:" ¬∑ l‚Äôapr√®s-midi":"";_>.5?(M.style.display="block",M.textContent=T.snowExpected+A+" ¬∑ "+Math.round(10*_)/10+T.snowCmTotal):E>=2?(M.style.display="block",M.textContent=T.snowLikely+A+" ¬∑ "+E+T.snowHoursBelow):E>=1?(M.style.display="block",M.textContent=T.snowPossible+A+T.snowNearFreezing):M.style.display="none"}function showResults(e,t,n,a,l){if(setConfBadge(l),applyHorizonWording(l),document.getElementById("score-block").style.display="block",showSection("hero"),document.getElementById("uc-filter-wrap").style.display="block",showSection("sec-hourly"),renderHourly(e),!n){showSection("sec-scenarios");var r=genPess(t),o=genOpt(t);renderScCard(r,"sc-pess-strip","sc-pess-stats"),renderScCard(o,"sc-opt-strip","sc-opt-stats"),updateScenarioLabels(r,o)}if(a){var i=document.getElementById("foot-note");i.innerHTML=a,i.style.display="block"}setTimeout(function(){var e=document.getElementById("uc-filter-wrap");e&&e.scrollIntoView({behavior:"smooth",block:"start"})},120)}var acTimer=null,acIdx=-1,acData=[],selectedLoc=null;function flagEmoji(e){if(!e||2!==e.length)return"";var t={GF:"FR",GP:"FR",MQ:"FR",RE:"FR",PM:"FR",YT:"FR",NC:"FR",PF:"FR",WF:"FR",MF:"FR",BL:"FR"}[e]||e;return'<img src="'+CFG.flagBase+t.toLowerCase()+'.png" width="20" height="15" alt="'+e.toUpperCase()+'" style="vertical-align:middle;border-radius:2px;margin-right:4px" onerror="this.style.display=\'none\'">'}function hideAC(){document.getElementById("ac-list").style.display="none",acIdx=-1}function showAC(e){var t=(e||[]).slice().sort(function(e,t){return(t.population||0)-(e.population||0)});acData=t,acIdx=-1;var n=document.getElementById("ac-list");if(n.innerHTML="",acData.length){for(var a=0;a<acData.length;a++)(function(e,t){var a=document.createElement("div");a.className="ac-item";var l=getAcSub(e);a.innerHTML="<span>"+flagEmoji(e.country_code)+" "+e.name+'</span><span class="ac-sub">'+l+"</span>",a.onmousedown=function(e){e.preventDefault(),selectAC(t)},n.appendChild(a)})(acData[a],a);n.style.display="block"}else n.style.display="none"}var COUNTRY_NAMES=CFG.countryFull;function getCountryName(e){return e.country||COUNTRY_NAMES[e.country_code]||e.country_code||""}var DOMTOM_CODES=["GP","MQ","RE","GF","YT","PM","NC","PF","WF","BL","MF"];function isFranceMetro(e){if("FR"!==e.country_code)return!1;var t=parseFloat(e.latitude),n=parseFloat(e.longitude);return t>=41&&t<=52&&n>=-5.5&&n<=10}COUNTRY_NAMES={GP:"Guadeloupe",MQ:"Martinique",RE:"La R√©union",GF:"Guyane fran√ßaise",YT:"Mayotte",PM:"Saint-Pierre-et-Miquelon",NC:"Nouvelle-Cal√©donie",PF:"Polyn√©sie fran√ßaise",WF:"Wallis-et-Futuna",BL:"Saint-Barth√©lemy",MF:"Saint-Martin",FR:"France",BE:"Belgique",CH:"Suisse",LU:"Luxembourg",CA:"Canada",US:"√âtats-Unis",GB:"Royaume-Uni",DE:"Allemagne",ES:"Espagne",IT:"Italie",PT:"Portugal",NL:"Pays-Bas",MA:"Maroc",TN:"Tunisie",DZ:"Alg√©rie",SN:"S√©n√©gal",CI:"C√¥te d'Ivoire",CM:"Cameroun"};function countryName(e,t){return COUNTRY_NAMES[e]||t||e||""}function getFrTerritory(e,t){return e=parseFloat(e),t=parseFloat(t),e>=41&&e<=52&&t>=-5.5&&t<=10?null:e>=14&&e<=18&&t>=-63&&t<=-60?"Guadeloupe":e>=14&&e<=15&&t>=-61.5&&t<=-60.5?"Martinique":e>=-22&&e<=-20&&t>=55&&t<=56?"La R√©union":e>=2&&e<=6&&t>=-55&&t<=-51?"Guyane":e>=-14&&e<=-12&&t>=44&&t<=46?"Mayotte":e>=-23&&e<=-20&&t>=163&&t<=168?"Nouvelle-Cal√©donie":e>=-18&&e<=-14&&t>=-150&&t<=-148?"Polyn√©sie fran√ßaise":e>=46&&e<=48&&t>=-57&&t<=-52?"Saint-Pierre-et-Miquelon":"Outre-mer"}function getAcSub(e){var t={GF:"Guyane fran√ßaise",GP:"Guadeloupe",MQ:"Martinique",RE:"La R√©union",PM:"Saint-Pierre-et-Miquelon",YT:"Mayotte",NC:"Nouvelle-Cal√©donie",PF:"Polyn√©sie fran√ßaise"},n=!!t[e.country_code];if("FR"===e.country_code||n){var a=(n?t[e.country_code]:getFrTerritory(e.latitude,e.longitude))||e.admin1||"";return a+(a?", ":"")+"France"}return(e.admin1||"")+(e.admin1&&e.country?", ":"")+(e.country||"")}function selectAC(e){var t=acData[e];if(t){var n=!!{GF:1,GP:1,MQ:1,RE:1,PM:1,YT:1,NC:1,PF:1}[t.country_code],a="FR"===t.country_code||n?n?{GF:"Guyane fran√ßaise",GP:"Guadeloupe",MQ:"Martinique",RE:"La R√©union",PM:"Saint-Pierre-et-Miquelon",YT:"Mayotte",NC:"Nouvelle-Cal√©donie",PF:"Polyn√©sie fran√ßaise"}[t.country_code]:"":t.admin1||"",l=n?"France":getCountryName(t);selectedLoc={lat:t.latitude,lon:t.longitude,name:t.name,region:a,country:l};var r=t.name;a&&(r+=", "+a),l&&(r+=" ("+l+")"),document.getElementById("inp-city").value=r,hideAC()}}function normalizeQuery(e){return e.replace(/ /g,"-").normalize("NFD").replace(/[ÃÄ-ÕØ]/g,"")}function fetchAC(e){var t=document.getElementById("city-hint");t&&(t.style.display="none");var n="https://geocoding-api.open-meteo.com/v1/search?count=6&language=fr&name=",a=fetch(n+encodeURIComponent(e)).then(function(e){return e.json()}).then(function(e){return e.results||[]}),l=normalizeQuery(e),r=e.indexOf(" ")>=0?fetch(n+encodeURIComponent(l)).then(function(e){return e.json()}).then(function(e){return e.results||[]}):Promise.resolve([]);Promise.all([a,r]).then(function(e){var t={},n=[];e[0].concat(e[1]).forEach(function(e){var a=e.name+"|"+e.latitude+"|"+e.longitude;t[a]||(t[a]=1,n.push(e))}),n.sort(function(e,t){return(t.population||0)-(e.population||0)}),showAC(n.slice(0,6))}).catch(function(){hideAC()})}function run(){var e=document.getElementById("inp-city").value.trim(),t=document.getElementById("inp-date"),n=t._isoValue||t.value,a=document.getElementById("btn-go"),l=document.getElementById("err-box"),r=document.getElementById("prog-wrap");if(!e){l.textContent="‚ö† Entrez une ville ou une destination avant de continuer.",l.style.display="block";var o=document.getElementById("inp-city");return o.style.borderColor="#dc2626",o.focus(),void o.addEventListener("input",function(){o.style.borderColor="",l.style.display="none"},{once:!0})}if(!n){l.textContent=T.errDate,l.style.display="block";var i=document.getElementById("inp-date");return i.style.borderColor="#dc2626",i.focus(),void i.addEventListener("change",function(){i.style.borderColor="",l.style.display="none"},{once:!0})}var s=n.split("-");if(3!==s.length)return l.textContent="‚ö† Format de date invalide.",void(l.style.display="block");var c=parseInt(s[0],10),u=parseInt(s[1],10)-1,d=parseInt(s[2],10);window._lastYr=c,window._lastMo=u,window._lastDa=d,window._lastDiff=null;var m=new Date;m.setHours(0,0,0,0);var p=new Date(c,u,d,0,0,0),h=Math.round((p.getTime()-m.getTime())/864e5);if(window._lastDiff=h,a.disabled=!0,l.style.display="none",hideSection("hero"),hideSection("sec-hourly"),hideSection("sec-scenarios"),document.getElementById("foot-note").style.display="none",r.style.display="block",setP(0,T.progLocating),!selectedLoc){var f=document.getElementById("err-box");f.textContent=T.errCity,f.style.display="block",setTimeout(function(){f.style.display="none"},4e3)}(selectedLoc?Promise.resolve(selectedLoc):geocode(e)).then(function(e){setP(5,e.name+T.progFound),document.getElementById("r-loc").textContent=e.name+" ‚Äî "+(e.country||""),document.getElementById("r-date").textContent=new Date(c,u,d,12,0,0).toLocaleDateString(CFG.dateLocale,{weekday:"long",day:"numeric",month:"long",year:"numeric"}),renderAstro(e.lat,e.lon,c,u,d),window._lastSSTResult=null;var t=slugFromName(e.name);return fetchMarineSST(e.lat,e.lon,c,u,d,t).then(function(e){window._lastSSTResult=e;var t=document.getElementById("sea-chip");t&&t.parentNode.removeChild(t),renderSeaChip(e)}),h>=0&&h<=7?(setP(30,T.progFetching),fetchForecast(e.lat,e.lon,c,u,d).then(function(t){renderAstro(e.lat,e.lon,c,u,d),setP(100,T.progDone);var n=13;0===h&&(n=new Date(Date.now()+1e3*(_locTzOffset||0)+6e4*(new Date).getTimezoneOffset()).getHours());updateHero(t,t,n),render7DayStrip(h),showResults(t,t,!0,T.noteLive,h),r.style.display="none",a.disabled=!1})):buildClimatology(e.lat,e.lon,c,u,d).then(function(t){return h>7&&h<=210?(setP(92,T.progEcmwf),fetchSeasonal(e.lat,e.lon,c,u,d).then(function(e){return applySeasonalCorrection(t,e)})):t}).then(function(t){renderAstro(e.lat,e.lon,c,u,d),setP(100,T.progDone),seedRand(makeSeed(e.lat,e.lon,c,u,d));var n=genMain(t);updateHero(n,t);var l=document.getElementById("forecast-strip");l&&(l.style.display="none"),showResults(n,t,!1,h>7&&h<=210?T.noteEcmwf:T.noteClimate,h);var o=document.getElementById("snow-depth-info");o&&(o.style.display="none"),"ski"===currentUseCase&&o&&fetchSnowDepth(e.lat,e.lon,c,u,d).then(function(e){if(e){var t=e.elevation?Math.round(e.elevation):null;if(t&&t<600)o.textContent=T.snowAltLow.replace("{e}",t),o.style.color="#94a3b8";else if(null!=e.depth){var n=t?T.snowElevAt.replace("{e}",t):"";o.textContent=T.snowEst.replace("{d}",e.depth).replace("{e}",n),o.style.color="#6366f1"}else o.textContent=T.snowNA,o.style.color="#94a3b8";o.style.display="block"}}),r.style.display="none",a.disabled=!1})}).catch(function(e){l.textContent=T.errPrefix+e.message,l.style.display="block",r.style.display="none",showSection("empty"),a.disabled=!1})}function toggleScoreTooltip(){var e=document.getElementById("score-tooltip");e.classList.toggle("visible"),e.classList.contains("visible")&&setTimeout(function(){document.addEventListener("click",function t(n){e.contains(n.target)||"score-info-btn"===n.target.id||e.classList.remove("visible"),document.removeEventListener("click",t)})},10)}function updateScoreTooltip(e){var t=UC_CONFIG[e]||UC_CONFIG.general,n=t.weights,a=document.getElementById("score-tooltip"),l={plage:T.ucBeach,ski:T.ucSki,general:T.ucGeneral}[e]||e;a.innerHTML='<strong style="font-size:12px">Score ¬∑ '+l+"</strong><br>"+T.tipRainLbl+n.rain+"%<br>"+T.tipTempLbl+n.temp+"%<br>"+T.tipWindLbl+n.wind+"%<br>"+T.tipSunLbl+n.sun+'%<br><span style="opacity:.6;font-size:10px">'+T.tipIdealRange+" "+fmtTempRaw(t.tempMin)+"‚Äì"+fmtTempRaw(t.tempMax)+fmtTempUnit()+"</span>"}function markRecommendedMonths(){var e=document.querySelectorAll(".month-card");if(e.length&&("general"===currentUseCase?null:currentUseCase)){for(var t=[],n=0;n<e.length;n++){var a=parseInt(e[n].dataset.monthIdx);t.push({idx:n,monthIdx:a,score:parseFloat(e[n].dataset.score||0)})}if(t.length){t.sort(function(e,t){return t.score-e.score});for(var l=[],r=0;r<Math.min(2,t.length);r++)t[r].score>=55&&l.push(t[r].idx);for(var o=0;o<e.length;o++)l.indexOf(o)>=0?e[o].classList.add("recommended"):e[o].classList.remove("recommended")}}}function switchMode(e){var t="date"===e;document.getElementById("mode-date").className="mode-btn"+(t?" active":""),document.getElementById("mode-annual").className="mode-btn"+(t?"":" active"),document.getElementById("annual-wrap").style.display=t?"none":"block";["date-form","hero","sec-hourly","sec-scenarios","empty","foot-note","uc-filter-wrap"].forEach(function(e){var n=document.getElementById(e);n&&(n.style.display=t?"empty"===e?"block":n._wasDisplay||"":"none")}),t&&(document.getElementById("empty").style.display="block")}var annAcTimer=null,annAcIdx=-1,annAcData=[],annSelectedLoc=null;function hideAnnAC(){document.getElementById("ann-ac-list").style.display="none",annAcIdx=-1}function showAnnAC(e){annAcData=e||[],annAcIdx=-1;var t=document.getElementById("ann-ac-list");if(t.innerHTML="",annAcData.length){for(var n=0;n<annAcData.length;n++)(function(e,n){var a=document.createElement("div");a.className="ac-item";var l=getAcSub(e);a.innerHTML="<span>"+flagEmoji(e.country_code)+" "+e.name+'</span><span class="ac-sub">'+l+"</span>",a.onmousedown=function(e){e.preventDefault(),selectAnnAC(n)},t.appendChild(a)})(annAcData[n],n);t.style.display="block"}else t.style.display="none"}function selectAnnAC(e){var t=annAcData[e];if(t){var n="FR"===t.country_code?"":t.admin1||"",a=getCountryName(t);annSelectedLoc={lat:t.latitude,lon:t.longitude,name:t.name,region:n,country:a};var l=t.name;n&&(l+=", "+n),a&&(l+=" ("+a+")"),document.getElementById("ann-city").value=l,hideAnnAC()}}function runAnnual(){var e=document.getElementById("ann-city").value.trim();if(!e){l.textContent="‚ö† Entrez une ville ou une destination avant de continuer.",l.style.display="block";var t=document.getElementById("ann-city");return t.style.borderColor="#dc2626",t.focus(),void t.addEventListener("input",function(){t.style.borderColor="",l.style.display="none"},{once:!0})}var n=document.getElementById("ann-btn"),a=document.getElementById("ann-prog-wrap"),l=document.getElementById("ann-err-box"),r=document.getElementById("annual-result");n.disabled=!0,l.style.display="none",r.style.display="none",a.style.display="block",setAnnP(0,T.progLocating),(annSelectedLoc?Promise.resolve(annSelectedLoc):geocode(e)).then(function(e){setAnnP(10,T.progFetchData);var t=findCachedMonthly(e.lat,e.lon),l=t?(setAnnP(30,T.progCache),Promise.resolve(t)):(setAnnP(10,T.progDownload),MONTHLY_CACHE_PROMISE.then(function(){var t=findCachedMonthly(e.lat,e.lon);return t||fetchAnnualArchive(e)})),r=fetchAnnualSeasonal(e.lat,e.lon);return Promise.all([l,r]).then(function(t){var l=t[0],r=t[1]||{},o=findFicheScores(e.lat,e.lon),i=o[0]||e.lat+","+e.lon,s=o[1]||null;if(s)for(var c=0;c<12;c++)l[c].ficheScore=s[c];computeAnchoredScores(l,i);for(var u=(new Date).getMonth(),d=0;d<7;d++){var m=(u+d)%12;if(r[m]&&null!=l[m].avgTemp){var p=r[m],h=l[m],f=p.tMean-h.avgTemp,y=Math.round(.4*f*10)/10;h.avgTemp=Math.round(10*(h.avgTemp+.4*f))/10,h.avgTmax=null!=h.avgTmax?Math.round(10*(h.avgTmax+.4*f))/10:null,h.avgTmin=null!=h.avgTmin?Math.round(10*(h.avgTmin+.4*f))/10:null,h.seasTempDelta=Math.abs(y)>=.3?y:null;var g=null;if(null!=p.rainProb){var v=h.rainPct;h.rainPct=Math.min(100,Math.max(0,Math.round(.6*h.rainPct+.4*p.rainProb))),g=h.rainPct-v}h.seasRainDelta=null!=g&&Math.abs(g)>=3?g:null,h.hasSeasonal=!0}}setAnnP(100,T.progDone),renderAnnual(e,l),a.style.display="none",n.disabled=!1})}).catch(function(e){l.textContent=T.errPrefix+e.message,l.style.display="block",a.style.display="none",n.disabled=!1})}function setAnnP(e,t){document.getElementById("ann-prog-bar").style.width=e+"%",document.getElementById("ann-prog-pct").textContent=e+"%",t&&(document.getElementById("ann-prog-lbl").textContent=t)}function fetchAnnualArchive(e){var t=(new Date).getFullYear()-1,n=t-9+"-01-01",a=t+"-12-31",l="https://archive-api.open-meteo.com/v1/archive?latitude="+e.lat+"&longitude="+e.lon+"&start_date="+n+"&end_date="+a+"&daily=temperature_2m_max,temperature_2m_min,precipitation_sum,shortwave_radiation_sum,sunshine_duration&timezone=auto";return fetch(l).then(function(e){return e.ok?e.json():e.json().catch(function(){return{}}).then(function(t){var n=t&&t.reason?t.reason:"HTTP "+e.status;throw new Error(T.errDataReason.replace("{r}",n))})}).then(function(e){if(!e||!e.daily||!e.daily.time||0===e.daily.time.length)throw new Error(T.errData);return setAnnP(70,T.progAggregation),aggregateByMonth(e)}).catch(function(t){if(t.message&&t.message.indexOf("sunshine")>=0){var l="https://archive-api.open-meteo.com/v1/archive?latitude="+e.lat+"&longitude="+e.lon+"&start_date="+n+"&end_date="+a+"&daily=temperature_2m_max,temperature_2m_min,precipitation_sum,shortwave_radiation_sum&timezone=auto";return fetch(l).then(function(e){if(!e.ok)throw new Error(T.errData);return e.json()}).then(function(e){return setAnnP(70,T.progAggregation),aggregateByMonth(e)})}throw t})}function fetchAnnualSeasonal(e,t){var n=new Date,a=n.toISOString().split("T")[0],l=new Date(n.getTime()+18144e6).toISOString().split("T")[0];return fetch("https://seasonal-api.open-meteo.com/v1/seasonal?latitude="+e+"&longitude="+t+"&daily=temperature_2m_mean,precipitation_sum&start_date="+a+"&end_date="+l).then(function(e){return e.ok?e.json():null}).then(function(e){if(!e||!e.daily||!e.daily.time)return{};for(var t=e.daily.time,n=Object.keys(e.daily),a={},l=0;l<t.length;l++){var r=parseInt(t[l].split("-")[1],10)-1;a[r]||(a[r]={temps:[],precips:[]});for(var o=0;o<n.length;o++){var i=n[o],s=e.daily[i][l];null!=s&&(0===i.indexOf("temperature_2m_mean")&&a[r].temps.push(s),0===i.indexOf("precipitation_sum")&&a[r].precips.push(s))}}for(var c={},u=Object.keys(a),d=0;d<u.length;d++){var m=parseInt(u[d],10),p=a[m];if(p.temps.length){for(var h=0,f=0;f<p.temps.length;f++)h+=p.temps[f];for(var y=0,g=0;g<p.precips.length;g++)p.precips[g]>.5&&y++;c[m]={tMean:h/p.temps.length,rainProb:p.precips.length?Math.round(y/p.precips.length*100):null}}}return c}).catch(function(){return{}})}function p50(e){if(!e||!e.length)return null;var t=e.slice().sort(function(e,t){return e-t}),n=Math.floor(t.length/2);return t.length%2?t[n]:(t[n-1]+t[n])/2}function aggregateByMonth(e){for(var t=[],n=0;n<12;n++)t.push({tmax:[],tmin:[],precip:[],rad:[],sun:[]});for(var a=e.daily.time,l=e.daily.temperature_2m_max,r=e.daily.temperature_2m_min,o=e.daily.precipitation_sum,i=e.daily.shortwave_radiation_sum||[],s=e.daily.sunshine_duration||[],c=0;c<a.length;c++){var u=parseInt(a[c].split("-")[1],10)-1;null!=l[c]&&t[u].tmax.push(l[c]),null!=r[c]&&t[u].tmin.push(r[c]),null!=o[c]&&t[u].precip.push(o[c]),null!=i[c]&&t[u].rad.push(i[c]),null!=s[c]&&t[u].sun.push(s[c])}return t.map(function(e,t){var n=p50(e.tmax),a=p50(e.tmin),l=null!=n&&null!=a?(n+a)/2:null,r=e.precip.filter(function(e){return e>1}).length,o=e.precip.length?Math.round(r/e.precip.length*100):0,i=p50(e.rad)||0;return{month:t,avgTmax:n,avgTmin:a,avgTemp:l,rainPct:o,sunHrs:e.sun.length?Math.min(14,p50(e.sun)/3600):Math.min(14,i/3.6),avgRad:i,avgPrecipMm:e.precip.length?Math.round(10*(p50(e.precip)||0))/10:0}})}function monthScoreForUC(e,t){if((!t||"general"===t)&&null!=e.ficheScore)return e.ficheScore;var n=UC_CONFIG[t]||UC_CONFIG.general,a=n.weights,l=scoreRainSmart(e.rainPct,e.avgPrecipMm,e.avgTemp),r=scoreSun(50*(e.sunHrs||0));if(!t||"general"===t)return null!=e.ficheScore?Math.round(10*e.ficheScore):50;if("ski"===t){var o,i=null!=e.avgTmax?e.avgTmax:null!=e.avgTemp?e.avgTemp+4:5,s=null!=e.avgTmin?e.avgTmin:null!=e.avgTemp?e.avgTemp-4:0,c=e.rainPct||0,u=e.avgPrecipMm||0,d=e.sunHrs||0;o=i>10?0:i>5?Math.max(0,50-10*(i-5)):i>=-2?90+2*(2-Math.abs(i)):i>=-12?90-3*(Math.abs(i)-2):Math.max(30,90-3*(Math.abs(i)-2));var m=s<0&&u>2?Math.min(100,60+3*u):s<0&&u>0?55:20,p=Math.min(100,8*d),h=i>2?Math.max(0,100-1.5*c):Math.max(40,100-.3*c);return Math.round(.15*h+.4*o+.2*m+.25*p)}if("plage"===t){var f;i=null!=e.avgTmax?e.avgTmax:null!=e.avgTemp?e.avgTemp+5:20,c=e.rainPct||0,d=e.sunHrs||0;f=i<18?0:i<22?(i-18)/4*20:i<26?20+(i-22)/4*60:i<=35?80+(i-26)/9*20:i<=40?100-(i-35)/5*30:Math.max(40,70-5*(i-40));var y=Math.max(0,100-1.8*c),g=Math.min(100,8*d);return Math.round(.35*y+.45*f+.2*g)}var v=scoreTemp(e.avgTemp,n.tempMin,n.tempMax);return Math.round(l*a.rain/100+v*a.temp/100+85*a.wind/100+r*a.sun/100)}function monthScore(e){return monthScoreForUC(e,"general"!==currentUseCase?currentUseCase:"general")}function monthColor(e){var t=e.avgTemp;return null==t?"#a0aec0":t>=25?"#f59e0b":t>=18?"#84cc16":t>=10?"#22d3ee":t>=2?"#818cf8":"#93c5fd"}function monthIconFromData(e){var t=e.sunHrs||0,n=e.rainPct||0,a=null!=e.avgTmin?e.avgTmin:e.avgTemp;if(null!=a&&a<=2&&n>15)return IC.snow;var l=n,r=null!=e.avgTemp?e.avgTemp:null!=e.avgTmax?e.avgTmax-4:null;null!=r&&r>=22&&t>=4&&(l*=r>=24?.55:.55+(24-r)/2*.1);return l<=25&&t>=6||l<=35&&t>=8?IC.sun:l<=55&&t>=7||l<=45&&t>=5?IC.shower:l<=45&&t>=3||l<=35?IC.partcloud:l<=65&&t>=3?IC.lightrain:l<=65||l<=80?IC.rain:IC.heavyrain}var MONTHS_FR=T.months,MONTHS_SHORT=T.monthsShort;function renderAnnual(e,t){_lastMonthly=t,_lastAnnLoc=e,document.getElementById("ann-city-name").textContent=e.name+(e.country?" ‚Äî "+e.country:"");var n=document.getElementById("months-grid");n.innerHTML="";var a="general"!==currentUseCase?currentUseCase:null,l=document.getElementById("annual-subtitle"),r=document.getElementById("annual-subtitle-uc");if(a&&r){l.style.display="none";var o={plage:T.bestBeach,ski:T.bestSki};r.textContent=o[a]||T.optimisedFor+" "+({plage:"plage",ski:"ski"}[a]||a),r.style.display="block"}else l&&(l.style.display="block"),r&&(r.style.display="none");for(var i=[],s=0;s<12;s++)i.push({idx:s,score:monthScoreForUC(t[s],a||"general")});var c,u,d=i.slice().sort(function(e,t){return t.score-e.score});"ski"===a?(c=i.filter(function(e){return e.score>=70}).map(function(e){return e.idx}),u=i.filter(function(e){return e.score<40}).map(function(e){return e.idx})):(c=d[0].score>=55?d[1].score>=55?[d[0].idx,d[1].idx]:[d[0].idx]:[],u=d[11].score<50?d[10].score<50?[d[10].idx,d[11].idx]:[d[11].idx]:[]);for(var m=(new Date).getMonth(),p=0;p<12;p++){var h=(m+p)%12,f=t[h],y=i[h].score,g=monthColor(f),v=40*p,x=c.indexOf(h)>=0,w=u.indexOf(h)>=0,M=document.createElement("div");M.className="month-card"+(x?" is-rec":"")+(w?" is-avoid":""),M.style.setProperty("--month-color",x?"#1a7a4a":w?CFG.avoidColor:g),M.style.animationDelay=v+"ms";var b='<div class="month-score score-num-uc" style="background:'+getScoreColor(y)+';color:white">'+(100===y?"10":(y/10).toFixed(1))+"</div>",C=[];null!=f.seasTempDelta&&C.push((f.seasTempDelta>0?"+":"")+f.seasTempDelta+"¬∞"),null!=f.seasRainDelta&&C.push((f.seasRainDelta>0?"+":"")+f.seasRainDelta+"% "+T.wordRain);var _=C.length?" ¬∑ "+C.join(" ¬∑ "):"",I=f.hasSeasonal?'<div class="month-seas-badge">'+T.ecmwfTrend+(_?'<br><span style="font-weight:500;text-transform:none;letter-spacing:0;color:#3b82f6">'+C.join(" ¬∑ ")+"</span>":"")+"</div>":'<div class="month-seas-badge" style="visibility:hidden">¬∑</div>',E=a&&h===d[0].idx&&d[0].score>=60,k=(x?'<div class="month-badge rec">'+T.badgeRec+"</div>":w?'<div class="month-badge avoid">'+T.badgeAvoid+"</div>":"")+(E?'<div class="month-best-badge">'+T.badgeBest+"</div>":""),S=null!=f.avgTmax?fmtTempRaw(f.avgTmax)+"¬∞":"‚Äì",B=null!=f.avgTmin?fmtTempRaw(f.avgTmin)+"¬∞":"‚Äì",A=null!=f.avgTemp?fmtTempRaw(f.avgTemp)+"¬∞":"‚Äì";M.innerHTML='<div class="month-name">'+MONTHS_FR[h]+'</div><div class="month-icon">'+monthIconFromData(f)+'</div><div class="month-temp">'+B+" / "+S+'</div><div class="month-range">'+T.avgLabel+" "+A+'</div><div class="month-stats"><span class="month-stat">üíß '+f.rainPct+'% <span style="font-weight:400;color:var(--slate3);font-size:10px">('+fmtPrecip(f.avgPrecipMm)+"/"+T.dayAbbr+')</span></span><span class="month-stat">‚òÄ '+Math.round(f.sunHrs)+'h</span></div><div class="month-bar"><div class="month-bar-fill" style="width:'+f.rainPct+'%"></div></div>'+b+k+I,n.appendChild(M)}var F=document.getElementById("annual-legend");F||((F=document.createElement("div")).id="annual-legend",F.style.cssText="display:flex;gap:16px;flex-wrap:wrap;font-size:11px;color:var(--slate3);margin-top:10px;align-items:center;padding:0 2px",F.innerHTML='<span><span style="display:inline-block;width:12px;height:3px;background:#1a7a4a;border-radius:2px;margin-right:5px;vertical-align:middle"></span>'+T.badgeRec+'</span><span><span style="display:inline-block;width:12px;height:3px;background:'+CFG.avoidColor+';border-radius:2px;margin-right:5px;vertical-align:middle"></span>'+T.badgeAvoid+'</span><span style="margin-left:auto;font-style:italic;font-size:10px">'+T.legendBarColor+"</span>",n.parentNode.insertBefore(F,n.nextSibling)),document.getElementById("ann-note").innerHTML=T.annualNote;var P=document.getElementById("ann-narrative");if(P){var R=T.monthsLower,L=i.slice().sort(function(e,t){return t.score-e.score}),D=L[0],O=L[1],H=L[11],N=L[10],G=i.filter(function(e){return e.score>=60}).map(function(e){return e.idx}),U=({plage:T.narBeach,ski:T.narSki,general:T.narGeneral}[a||"general"]||T.narGeneral,R[D.idx]),z=R[O.idx],Y=R[H.idx],W=(D.score>=75?"üåü":D.score>=60?"‚úÖ":"‚ö†Ô∏è")+" <strong>"+T.narBestMonth+" "+U.charAt(0).toUpperCase()+U.slice(1);O.score>=55&&(W+=" "+T.narAnd+" "+z),W+="</strong>",G.length>=2&&(W+=" ¬∑ "+T.narWindow+" <strong>"+G.length+" "+T.narMonths+"</strong>"),a&&H.score<50&&(W+=" ¬∑ "+T.narAvoid+' <span style="color:#ef4444;font-weight:700">'+Y+"</span>",N.score<50&&(W+=" "+T.narAnd+" "+R[N.idx]));var j=t[D.idx];j&&j.avgTmax&&(W+=" ¬∑ "+fmtTemp(j.avgTmax)+" max ¬∑ "+j.rainPct+"% "+T.wordRain),P.innerHTML=W,P.style.display="block"}document.getElementById("annual-result").style.display="block",setTimeout(function(){var e=document.getElementById("annual-result");e&&e.scrollIntoView({behavior:"smooth",block:"start"})},120)}function clearCity(){var e=document.getElementById("inp-city");e.value="",selectedLoc=null,document.getElementById("inp-city-clear").classList.remove("visible"),hideAC(),e.focus()}function clearAnnCity(){var e=document.getElementById("ann-city");e.value="",annSelectedLoc=null,document.getElementById("ann-city-clear").classList.remove("visible"),hideAnnAC(),e.focus()}document.getElementById("btn-go").onclick=function(){run()},document.getElementById("ann-city").oninput=function(){annSelectedLoc=null;var e=this.value.trim();clearTimeout(annAcTimer),document.getElementById("ann-city-clear").classList.toggle("visible",e.length>0),e.length<2?hideAnnAC():annAcTimer=setTimeout(function(){fetch("https://geocoding-api.open-meteo.com/v1/search?name="+encodeURIComponent(e)+"&count=6&language=fr").then(function(e){return e.json()}).then(function(e){showAnnAC(e.results||[])}).catch(function(){hideAnnAC()})},280)},document.getElementById("ann-city").onblur=function(){setTimeout(hideAnnAC,180)},document.getElementById("ann-city").onkeydown=function(e){var t=document.getElementById("ann-ac-list"),n=t.querySelectorAll(".ac-item"),a=n.length;if("ArrowDown"===e.key){e.preventDefault(),annAcIdx=annAcIdx<a-1?annAcIdx+1:a-1;for(var l=0;l<a;l++)n[l].className="ac-item"+(l===annAcIdx?" sel":"")}else if("ArrowUp"===e.key){e.preventDefault(),annAcIdx=annAcIdx>0?annAcIdx-1:0;for(l=0;l<a;l++)n[l].className="ac-item"+(l===annAcIdx?" sel":"")}else"Enter"===e.key?annAcIdx>=0&&"none"!==t.style.display?selectAnnAC(annAcIdx):(hideAnnAC(),runAnnual()):"Escape"===e.key&&hideAnnAC()},document.getElementById("annual-wrap").style.display="none",quickFill("general"),document.getElementById("date-form").addEventListener("click",function(){if(this.classList.contains("uc-required")){var e=document.getElementById("uc-hint");e&&e.classList.add("visible");for(var t=document.querySelectorAll(".uc-pill"),n=0;n<t.length;n++)t[n].style.borderColor="var(--gold)",function(e){setTimeout(function(){e.style.borderColor=""},800)}(t[n])}},!0),document.getElementById("annual-wrap").addEventListener("click",function(){if(this.classList.contains("uc-required-ann")){var e=document.getElementById("uc-hint-ann");e&&e.classList.add("visible");for(var t=document.querySelectorAll(".uc-pill"),n=0;n<t.length;n++)t[n].style.borderColor="var(--gold)",function(e){setTimeout(function(){e.style.borderColor=""},800)}(t[n])}},!0),document.addEventListener("DOMContentLoaded",function(){flatpickr(document.getElementById("inp-date"),{dateFormat:"d/m/Y",locale:"fr",minDate:"today",maxDate:new Date((new Date).setFullYear((new Date).getFullYear()+1)),disableMobile:!0,onChange:function(e,t){var n=document.getElementById("inp-date");if(n.classList.toggle("has-val",e.length>0),e.length>0){var a=e[0];n._isoValue=a.getFullYear()+"-"+(a.getMonth()<9?"0":"")+(a.getMonth()+1)+"-"+(a.getDate()<10?"0":"")+a.getDate()}else n._isoValue=""}})}),document.getElementById("inp-city").oninput=function(){selectedLoc=null;var e=this.value.trim();clearTimeout(acTimer),document.getElementById("inp-city-clear").classList.toggle("visible",e.length>0),e.length<2?hideAC():acTimer=setTimeout(function(){fetchAC(e)},280)},document.getElementById("inp-city").onblur=function(){setTimeout(hideAC,180)},document.getElementById("inp-city").onkeydown=function(e){var t=document.getElementById("ac-list"),n=t.querySelectorAll(".ac-item"),a=n.length;if("ArrowDown"===e.key){e.preventDefault(),acIdx=acIdx<a-1?acIdx+1:a-1;for(var l=0;l<a;l++)n[l].className="ac-item"+(l===acIdx?" sel":"")}else if("ArrowUp"===e.key){e.preventDefault(),acIdx=acIdx>0?acIdx-1:0;for(l=0;l<a;l++)n[l].className="ac-item"+(l===acIdx?" sel":"")}else"Enter"===e.key?acIdx>=0&&"none"!==t.style.display?selectAC(acIdx):(hideAC(),run()):"Escape"===e.key&&hideAC()},document.getElementById("inp-date").onkeydown=function(e){"Enter"===e.key&&run()};var tom=new Date,maxD=new Date;tom.setHours(0,0,0,0),maxD.setFullYear(maxD.getFullYear()+2),function(){function e(e){for(var t=window.location.search.substring(1).split("&"),n=0;n<t.length;n++){var a=t[n].split("=");if(decodeURIComponent(a[0])===e)return decodeURIComponent(a[1]||"")}return null}var t=e("city"),n=e("lat"),a=e("lon"),l=e("uc");t&&n&&a&&(switchMode("annual"),document.getElementById("ann-city").value=t,document.getElementById("ann-city-clear").classList.add("visible"),annSelectedLoc={lat:parseFloat(n),lon:parseFloat(a),name:t,region:"",country:""},l&&(currentUseCase=l,quickFill(l)),setTimeout(function(){runAnnual()},100))}();